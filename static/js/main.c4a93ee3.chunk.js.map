{"version":3,"sources":["services/knownFeeds.js","services/feed.js","duck/users.js","components/Modal.js","components/ConfirmationModal.js","services/orbit.js","services/drafts.js","duck/drafts.js","reducers.js","components/Logo.js","pages/Header.js","pages/WritePage.js","pages/HomePage.js","pages/DraftPage.js","pages/DraftEditorPage.js","UserList.js","pages/TrackedPage.js","PersonalInfoForm.js","pages/EditProfilePage.js","components/WriteFloatingButton.js","Routes.js","App.js","serviceWorker.js","index.js","Editor.js","components/Loader.js","components/FullPageLoader.js","duck/notifications.js","duck/error.js","utilities/formatDate.js","EmptyList.js","InvalidAddress.js","utilities/readingTime.js","CardList.js","pages/FeedPage.js","UserDetails.js","components/ShareProfile.js","pages/ArticlePage.js"],"names":["knownFeedsDb","getKnownFeeds","_callee","orbit","db","regenerator_default","a","wrap","_context","prev","next","getOrbit","sent","orbitdb","docs","load","abrupt","stop","this","saveKnownFeed","_x","_saveKnownFeed","apply","arguments","_callee3","_ref","userHash","userAddress","metaAddress","feedAddress","newEntry","dbEntry","oldEntry","updatedEntry","_context3","get","Object","assign","put","objectSpread","_id","getPinnedFeeds","_getPinnedFeeds","_callee4","_context4","query","d","pinned","map","f","pinFeed","_x2","_x3","_pinFeed","_callee5","hash","entry","_context5","createFeedInstance","_createFeedInstance","_callee9","callback","ipfs","userMetaDb","feedDb","userDb","access","loadSelf","_loadSelf","loadRemote","_loadRemote","setUserMeta","addToFeed","_addToFeed","deleteFromFeed","_deleteFromFeed","getUserMeta","getUserFeed","getFeedPage","getUserArticle","broadcastPeers","_broadcastPeers","_context9","asyncToGenerator","mark","_callee8","networkPeers","userDbPeers","feedDbPeers","userMetaDbPeers","_context8","swarm","peers","pubsub","address","toString","lt","limit","length","undefined","iterator","collect","e","payload","value","feedLen","keys","_index","_callee7","_context7","remove","_x5","_callee6","title","description","text","_context6","add","createdAt","Date","now","_x4","userMeta","set","replicateData","_replicateData","renderMeta","_renderMeta","renderFeed","_renderFeed","_callee2","_userDb$iterator$coll3","_userDb$iterator$coll4","_context2","slicedToArray","keyvalue","feed","events","on","console","log","progress","have","sync","replicate","create","_userDb$iterator$coll","_userDb$iterator$coll2","t0","setInterval","CREATE_USER","SET_USERDB_ADDR","SET_USER_FEED","SET_USER_METADATA","SET_USERDB_INSTANCE","SET_USER_MASTER","SET_USER_HASH","ADD_ARTICLE","SET_USER_PINNED","SET_REPLICATION","ADD_USER_FEED","UserRecord","Record","dbInstance","metadata","articles","Map","dbAddress","replication","meta","metaProgress","total","current","feedProgress","isMaster","initialUsers","init","dispatch","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","Symbol","done","loadPinned","return","finish","advanceFeedPage","_ref2","getState","user","lastPost","newPage","users","first","addUserFeedPage","pin","_ref3","setUserPinned","_ref4","info","concat","createUser","_len","args","Array","_key","handleDbMessage","setUserDbInstance","setUserHash","_x6","_ref5","_x7","_x8","loadMaster","_ref6","err","status","arg","split","setUserMaster","setUserDbAddr","error","_x9","_x10","setUnrecoverableError","type","setUserMetadata","setUserDbFeed","setReplication","message","has","addNotification","feedLink","getArticle","articleHash","articleData","article","addArticle","setMasterMetadata","find","u","addMasterArticle","_ref7","deleteMasterArticle","dataType","reducer","state","action","setIn","updateIn","oldFeed","unshift","toConsumableArray","List","appRoot","document","getElementById","Modal","preventDefault","node","addEventListener","preventScroll","removeEventListener","_this","children","props","ReactDOM","createPortal","react_default","createElement","ref","n","className","React","Component","ConfirmationModal","buttons","src_components_Modal","fi","__webpack_require__","__webpack_exports__","ConfirmationModal_ConfirmationModal","orbitInstance","isLoading","resolverQueue","initOrbit","D_vitriol_web_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","global","Ipfs","repo","EXPERIMENTAL","config","Addresses","Swarm","start","consumeQueue","D_vitriol_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__","OrbitDB","write","key","getPublic","instance","_i","resolver","cb","push","Promise","resolve","reject","createOrbit","draftsDb","getDraftsDb","indexBy","addDraft","_addDraft","draft","savedAt","putDraft","_putDraft","_db$get","_db$get2","oldDraft","removeDraft","_removeDraft","draftHash","del","queryDrafts","_queryDrafts","drafts","sort","b","SET_DRAFTS","deleteDraft","setDrafts","initialState","draftList","store","createStore","combineReducers","reducers","applyMiddleware","thunkMiddleware","Logo","_ref$className","_ref$strokeWidth","strokeWidth","width","height","viewBox","fill","xmlns","stroke","x1","y1","x2","y2","Header","masterUser","masterHash","toProfile","size","NavLink","activeClassName","to","pathname","internal","ConnectedHeader","connect","notifications","WritePage","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","doSave","_this$state$toSave","toSave","html","_this$props","history","location","goBack","hideConfirmation","setState","handleSave","handleSaveDraft","handleCancel","_this$props2","handleInfo","_this2","_this$props3","readOnly","es_Redirect","Editor","onCancel","onSaveDraft","onSave","Fragment","onClick","ConnectedWritePage","HomePage","Link","target","href","ConnectedHomePage","DraftPage","handleDelete","id","toDelete","CardList","articleList","linkFormatter","authorFormatter","onDelete","EmptyList","ConnectedDraftPage","DraftEditorPage","match","params","FullPageLoader","draftId","ConnectedDraftEditorPage","UserList","toArray","last","formatDate","TrackedPage","pinnedUsers","filter","unpinnedUsers","UserList_UserList","ConnectedTrackedPage","PersonalInfoForm","handleNameChange","name","handleInfoChange","handleLocationChange","handleSubmit","_this$state","onSubmit","hasInitialised","commitButton","_this$state2","isEnabled","onChange","placeholder","maxLength","rows","disabled","hasProps","EditProfilePage","toObject","PersonalInfoForm_PersonalInfoForm","ConnectedEditProfilePage","WriteFloatingButton","Routes","unrecoverable","window","reload","HashRouter","Route","component","View","Switch","exact","withWriteButton","path","FeedPage","ArticlePage","Redirect","WriteFloatingButton_WriteFloatingButton","ConnectedRoutes","App","es","src_Routes","Boolean","hostname","render","src_App_0","navigator","serviceWorker","ready","then","registration","unregister","D_vitriol_web_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","D_vitriol_web_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2__","D_vitriol_web_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3__","handleArticleChange","handleTitleChange","handleDescriptionChange","isDisabled","react__WEBPACK_IMPORTED_MODULE_5___default","author","react_router_dom__WEBPACK_IMPORTED_MODULE_7__","url","react_quill__WEBPACK_IMPORTED_MODULE_6___default","theme","modules","formats","bounds","toolbar","header","list","clipboard","matchVisual","Loader","style","position","top","bottom","left","right","display","alignItems","justifyContent","components_Loader","ADD_NOTIFICATION","notification","D_vitriol_web_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","read","immutable__WEBPACK_IMPORTED_MODULE_0__","SET_UNRECOVERABLE","ErrorRecord","date_fns_format__WEBPACK_IMPORTED_MODULE_0__","date_fns_format__WEBPACK_IMPORTED_MODULE_0___default","date","format","react__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_0___default","react_router_dom__WEBPACK_IMPORTED_MODULE_1__","InvalidAddress","react_icons_fi__WEBPACK_IMPORTED_MODULE_2__","ansiWordBound","c","re","FeedList","stopPropagation","i","scrapedImage","exec","imageSrc","onClickCapture","alt","src","options","wpm","wb","words","end","minutes","time","Math","ceil","toFixed","readingTime","removeArticle","handlePin","handleUnpin","handleMore","handleProfileEdit","currentUser","isValidAddress","_InvalidAddress__WEBPACK_IMPORTED_MODULE_11__","_components_FullPageLoader__WEBPACK_IMPORTED_MODULE_12__","showMore","reverse","_UserDetails__WEBPACK_IMPORTED_MODULE_8__","onEdit","showEdit","isPinned","onPin","onUnpin","_components_ShareProfile__WEBPACK_IMPORTED_MODULE_14__","_CardList__WEBPACK_IMPORTED_MODULE_9__","_EmptyList__WEBPACK_IMPORTED_MODULE_10__","_components_ConfirmationModal__WEBPACK_IMPORTED_MODULE_13__","ConnectedFeedPage","UserDetails","handlePinUser","pinnedClass","react_icons_fi__WEBPACK_IMPORTED_MODULE_6__","ShareProfile","handleCopy","writeText","showCopied","inputRef","select","execCommand","copied","setTimeout","handleClick","setSelectionRange","invalidAddress","isReplicating","articleObject","loading","_components_FullPageLoader__WEBPACK_IMPORTED_MODULE_10__","dompurify","sanitize","_Editor__WEBPACK_IMPORTED_MODULE_9__","ConnectedArticlePage"],"mappings":"4JACIA,EAAe,cAMJC,8EAAf,SAAAC,IAAA,IAAAC,EAAAC,EAAA,OAAAC,EAAAC,EAAAC,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EACsBC,cADtB,UACQR,EADRK,EAAAI,KAGOZ,EAHP,CAAAQ,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,EAIeP,EAAMU,QAAQC,KAAK,cAJlC,cAIIV,EAJJI,EAAAI,KAAAJ,EAAAE,KAAA,EAKUN,EAAGW,OALb,OAMIf,EAAeI,EANnB,eAAAI,EAAAQ,OAAA,SAQShB,GART,yBAAAQ,EAAAS,SAAAf,EAAAgB,gCA6BO,SAAeC,EAAtBC,GAAA,OAAAC,EAAAC,MAAAJ,KAAAK,sDAAO,SAAAC,EAAAC,GAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAAzB,EAAA0B,EAAAC,EAAAC,EAAAC,EAAA,OAAA5B,EAAAC,EAAAC,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,cAA8BgB,EAA9BD,EAA8BC,SAAUC,EAAxCF,EAAwCE,YAAaC,EAArDH,EAAqDG,YAAaC,EAAlEJ,EAAkEI,YAAlEK,EAAAxB,KAAA,EACYT,IADZ,cACCG,EADD8B,EAAAtB,KAECkB,EAAW,CAAEH,cAAaC,cAAaC,eACvCE,EAAU3B,EAAG+B,IAAIT,GACjBM,EAAWD,EAAUA,EAAQ,GAAK,GAClCE,EAAeG,OAAOC,OAAO,GAAIL,EAAUF,GAL5CI,EAAAxB,KAAA,GAMCN,EAAGkC,IAAHF,OAAAG,EAAA,EAAAH,CAAA,CAASI,IAAKd,GAAaO,IAN5B,yBAAAC,EAAAjB,SAAAO,EAAAN,gCASA,SAAeuB,IAAtB,OAAAC,EAAApB,MAAAJ,KAAAK,sDAAO,SAAAoB,IAAA,IAAAvC,EAAA,OAAAC,EAAAC,EAAAC,KAAA,SAAAqC,GAAA,cAAAA,EAAAnC,KAAAmC,EAAAlC,MAAA,cAAAkC,EAAAlC,KAAA,EACYT,IADZ,cACCG,EADDwC,EAAAhC,KAAAgC,EAAA5B,OAAA,SAEEZ,EAAGyC,MAAM,SAAAC,GAAC,OAAIA,EAAEC,SAAQC,IAAI,SAAAC,GAAC,OAAIA,EAAET,OAFrC,wBAAAI,EAAA3B,SAAA0B,EAAAzB,gCAKA,SAAegC,EAAtBC,EAAAC,GAAA,OAAAC,EAAA/B,MAAAJ,KAAAK,sDAAO,SAAA+B,EAAuBC,EAAMR,GAA7B,IAAA3C,EAAAoD,EAAA,OAAAnD,EAAAC,EAAAC,KAAA,SAAAkD,GAAA,cAAAA,EAAAhD,KAAAgD,EAAA/C,MAAA,cAAA+C,EAAA/C,KAAA,EACYT,IADZ,cACCG,EADDqD,EAAA7C,KAEC4C,EAAQpD,EAAG+B,IAAIoB,GAAM,GAFtBE,EAAA/C,KAAA,EAGCN,EAAGkC,IAAIF,OAAOC,OAAO,GAAImB,EAAO,CAAET,YAHnC,wBAAAU,EAAAxC,SAAAqC,EAAApC,gCC/CQ,SAAewC,EAA9BtC,EAAA+B,EAAAC,GAAA,OAAAO,EAAArC,MAAAJ,KAAAK,sDAAe,SAAAqC,EAAkCC,EAAUlC,EAAaD,GAAzD,IAAAoC,EAAAC,EAAAC,EAAAC,EAAApD,EAAAqD,EASEC,EATFC,EA4CEC,EA5CFC,EAqHJC,EAOMC,EA5HFC,EAoIEC,EApIFC,EA0IJC,EAKAC,EAQAC,EAOAC,EAKMC,EAnKFC,EAAA9E,EAAA,OAAAE,EAAAC,EAAAC,KAAA,SAAA2E,GAAA,cAAAA,EAAAzE,KAAAyE,EAAAxE,MAAA,cAAAuE,EAAA,kBAAAA,EAAA7C,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KAmKb,SAAAC,IAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAApF,EAAAC,EAAAC,KAAA,SAAAmF,GAAA,cAAAA,EAAAjF,KAAAiF,EAAAhF,MAAA,UACOoD,GAASG,GAAWD,GAAWD,EADtC,CAAA2B,EAAAhF,KAAA,eAAAgF,EAAA1E,OAAA,wBAAA0E,EAAAhF,KAAA,EAE6BoD,EAAK6B,MAAMC,QAFxC,cAEQN,EAFRI,EAAA9E,KAAA8E,EAAAhF,KAAA,EAG4BoD,EAAK+B,OAAOD,MAAM3B,EAAO6B,QAAQC,YAH7D,cAGQR,EAHRG,EAAA9E,KAAA8E,EAAAhF,KAAA,GAI4BoD,EAAK+B,OAAOD,MAAM5B,EAAO8B,QAAQC,YAJ7D,eAIQP,EAJRE,EAAA9E,KAAA8E,EAAAhF,KAAA,GAKgCoD,EAAK+B,OAAOD,MAAM7B,EAAW+B,QAAQC,YALrE,QAKQN,EALRC,EAAA9E,KAMEiD,EAAS,KAAM,QAAS,CAACyB,eAAcC,cAAaC,cAAaC,oBANnE,yBAAAC,EAAAzE,SAAAoE,EAAAnE,UAnKaI,MAAAJ,KAAAK,YAmKEyD,EAnKF,kBAAAC,EAAA3D,MAAAJ,KAAAK,YA8JJwD,EA9JI,SA8JWxB,GACtB,OAAKS,EACEA,EAAO7B,IAAIoB,GADEM,EAAS,iBARtBiB,EAvJI,SAuJQkB,GAAgB,IAAZC,EAAY1E,UAAA2E,OAAA,QAAAC,IAAA5E,UAAA,GAAAA,UAAA,GAAJ,GAC/B,OAAKyC,EACEA,EAAOoC,SAAS,CAAEH,QAAOD,OAC3BK,UACArD,IAAI,SAAAsD,GAAC,OAAAlE,OAAAG,EAAA,EAAAH,CAAA,GAAUkE,EAAEC,QAAQC,MAApB,CAA2BjD,KAAM+C,EAAE/C,KAAM7C,KAAM4F,EAAE5F,KAAKwF,WAH5CrC,EAAS,iBATtBgB,EA/II,WA+IoB,IAAZoB,EAAY1E,UAAA2E,OAAA,QAAAC,IAAA5E,UAAA,GAAAA,UAAA,GAAJ,GAC3B,IAAKyC,EAAQ,OAAOH,EAAS,gBAC7B,IAAM4C,EAAUrE,OAAOsE,KAAK1C,EAAO2C,OAAOA,QAAQT,OAClD,OAAOlC,EAAOoC,SAAS,CAAEH,UACpBI,UACArD,IAAI,SAAAsD,GAAC,OAAAlE,OAAAG,EAAA,EAAAH,CAAA,GAAUkE,EAAEC,QAAQC,MAApB,CAA2BjD,KAAM+C,EAAE/C,KAAM7C,KAAM4F,EAAE5F,KAAKwF,OAAQO,eAVjE7B,EA1II,WA2IX,OAAKb,EACEA,EAAW5B,IAAI,SADE0B,EAAS,iBA3ItBc,EAAA,kBAAAA,EAAAvC,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KAoIb,SAAAwB,EAA8BrD,GAA9B,OAAAlD,EAAAC,EAAAC,KAAA,SAAAsG,GAAA,cAAAA,EAAApG,KAAAoG,EAAAnG,MAAA,UAEOsD,EAFP,CAAA6C,EAAAnG,KAAA,eAAAmG,EAAA7F,OAAA,SAEsB6C,EAAS,iBAF/B,OAGEG,EAAO8C,OAAOvD,GAHhB,wBAAAsD,EAAA5F,SAAA2F,EAAA1F,UApIaI,MAAAJ,KAAAK,YAoIEmD,EApIF,SAAAqC,GAAA,OAAApC,EAAArD,MAAAJ,KAAAK,YAAAkD,EAAA,kBAAAA,EAAArC,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KA4Hb,SAAA4B,EAAAvF,GAAA,IAAAwF,EAAAC,EAAAC,EAAA,OAAA9G,EAAAC,EAAAC,KAAA,SAAA6G,GAAA,cAAAA,EAAA3G,KAAA2G,EAAA1G,MAAA,UAA0BuG,EAA1BxF,EAA0BwF,MAAOC,EAAjCzF,EAAiCyF,YAAaC,EAA9C1F,EAA8C0F,KAEvCnD,EAFP,CAAAoD,EAAA1G,KAAA,eAAA0G,EAAApG,OAAA,SAEsB6C,EAAS,iBAF/B,OAKEG,EAAOqD,IAAI,CAAEC,UAAWC,KAAKC,MAAOL,OAAMF,QAAOC,gBALnD,wBAAAE,EAAAnG,SAAA+F,EAAA9F,UA5HaI,MAAAJ,KAAAK,YA4HEiD,EA5HF,SAAAiD,GAAA,OAAAhD,EAAAnD,MAAAJ,KAAAK,YAqHJgD,EArHI,SAqHQmD,GAEnB,OAAK3D,EACDpC,EAAoBkC,EAAS,mCACjCE,EAAW4D,IAAI,QAASD,GAFA7D,EAAS,iBAvHtBS,EAAA,kBAAAA,EAAAlC,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KA4Cb,SAAA9B,IAAA,IAQiBsE,EARjBC,EA2DiBC,EA3DjBC,EAgEiBC,EAhEjBC,EAAA,OAAA5H,EAAAC,EAAAC,KAAA,SAAAkD,GAAA,cAAAA,EAAAhD,KAAAgD,EAAA/C,MAAA,cAAAuH,EAAA,kBAAAA,EAAA7F,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KAgEE,SAAAzC,IAAA,OAAAtC,EAAAC,EAAAC,KAAA,SAAAqC,GAAA,cAAAA,EAAAnC,KAAAmC,EAAAlC,MAAA,UACOsD,EADP,CAAApB,EAAAlC,KAAA,eAAAkC,EAAA5B,OAAA,iBAEE6C,EAAS,KAAM,WAAYgB,KAF7B,wBAAAjC,EAAA3B,SAAA0B,EAAAzB,UAhEFI,MAAAJ,KAAAK,YAgEiByG,EAhEjB,kBAAAC,EAAA3G,MAAAJ,KAAAK,YAAAwG,EAAA,kBAAAA,EAAA3F,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KA2DE,SAAA5D,IAAA,OAAAnB,EAAAC,EAAAC,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,UACOqD,EADP,CAAA7B,EAAAxB,KAAA,eAAAwB,EAAAlB,OAAA,iBAEE6C,EAAS,KAAM,WAAYe,KAF7B,wBAAA1C,EAAAjB,SAAAO,EAAAN,UA3DFI,MAAAJ,KAAAK,YA2DiBuG,EA3DjB,kBAAAC,EAAAzG,MAAAJ,KAAAK,YAAAsG,EAAA,kBAAAA,EAAAzF,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KAQE,SAAA8C,IAAA,IAAAC,EAAAC,EAAAxG,EAAAC,EAAA,OAAAxB,EAAAC,EAAAC,KAAA,SAAA8H,GAAA,cAAAA,EAAA5H,KAAA4H,EAAA3H,MAAA,WACMqD,IAAcC,EADpB,CAAAqE,EAAA3H,KAAA,eAAA2H,EAAArH,OAAA,oBAAAmH,EAGqClE,EAAOmC,SAAS,CAAEH,OAAQ,IAC5DI,UACArD,IAAI,SAACsD,GAAD,OAAOA,EAAEC,QAAQC,QALxB4B,EAAAhG,OAAAkG,EAAA,EAAAlG,CAAA+F,EAAA,GAGSvG,EAHTwG,EAAA,GAGsBvG,EAHtBuG,EAAA,GAOOxG,GAAgBC,EAPvB,CAAAwG,EAAA3H,KAAA,eAAA2H,EAAArH,OAAA,wBAAAqH,EAAA3H,KAAA,EAUqBG,EAAQ0H,SAAS3G,GAVtC,cAUEmC,EAVFsE,EAAAzH,KAAAyH,EAAA3H,KAAA,GAWiBG,EAAQ2H,KAAK3G,GAX9B,eAWEmC,EAXFqE,EAAAzH,KAaEO,EAAc,CAAEO,WAAUC,cAAaC,cAAaC,gBAEpDkC,EAAW0E,OAAOC,GAAG,aAAc,WACjCC,QAAQC,IAAI,oBACZd,IACAjE,EAAS,KAAM,aAAc,UAG/BE,EAAW0E,OAAOC,GAAG,YAAa,WAChCC,QAAQC,IAAI,mBACZ/E,EAAS,KAAM,YAAa,UAG9BE,EAAW0E,OAAOC,GAAG,aAAc,SAAC5C,GAAc6C,QAAQC,IAAI,QAAS9C,EAAS7B,KAChFF,EAAW0E,OAAOC,GAAG,0BAA2B,SAAC5C,EAASvC,EAAMC,EAAOqF,EAAUC,GAAjC,OAA0CH,QAAQC,IAAI,qBAAsB9C,EAASvC,EAAMC,EAAOqF,EAAUC,KAE5J9E,EAAOyE,OAAOC,GAAG,aAAc,WAC7BC,QAAQC,IAAI,sBACZZ,IACAnE,EAAS,KAAM,aAAc,UAG/BG,EAAOyE,OAAOC,GAAG,YAAa,WAC5BC,QAAQC,IAAI,qBACZ/E,EAAS,KAAM,YAAa,UAG9BG,EAAOyE,OAAOC,GAAG,eAAgB,SAAC5C,GAAc6C,QAAQC,IAAI,QAAS9C,EAAS7B,KAC9ED,EAAOyE,OAAOC,GAAG,mBAAoB,SAAC5C,GAAD,OAAa6C,QAAQC,IAAI,YAAa9C,KAC3E9B,EAAOyE,OAAOC,GAAG,4BAA6B,SAAC5C,EAASvC,EAAMC,EAAOqF,EAAUC,GAAjC,OAA0CH,QAAQC,IAAI,qBAAsB9C,EAASvC,EAAMC,EAAOqF,EAAUC,KA1C5JT,EAAA3H,KAAA,GA4CQqD,EAAWhD,OA5CnB,eAAAsH,EAAA3H,KAAA,GA6CQsD,EAAOjD,OA7Cf,QA+CE+G,IACAE,IAhDF,yBAAAK,EAAApH,SAAAiH,EAAAhH,UARFI,MAAAJ,KAAAK,YAQiBqG,EARjB,kBAAAC,EAAAvG,MAAAJ,KAAAK,YAAAkC,EAAA/C,KAAA,EACiBG,EAAQ+H,IAAIjH,EAAa,CAAEoH,MAAM,EAAMC,WAAW,EAAMC,QAAQ,IADjF,cACEhF,EADFR,EAAA7C,MAGS6H,OAAOC,GAAG,aAAcd,GAC/B3D,EAAOwE,OAAOC,GAAG,qBAAsB,SAAC5C,EAASvC,EAAMC,EAAOqF,EAAUC,GAAjC,OAA0CH,QAAQC,IAAI,qBAAsB9C,EAASvC,EAAMC,EAAOqF,EAAUC,KAEnJjF,EAAS,KAAM,cAAeI,EAAO6B,QAAQC,YAN/CtC,EAAA/C,KAAA,GAqEQuD,EAAOlD,OArEf,QAsEE6G,IAtEF,yBAAAnE,EAAAxC,SAAAqC,EAAApC,UA5CaI,MAAAJ,KAAAK,YA4CE8C,EA5CF,kBAAAC,EAAAhD,MAAAJ,KAAAK,YAAA6C,EAAA,kBAAAA,EAAAhC,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KASb,SAAAlF,IAAA,IAAAgJ,EAAAC,EAAAvH,EAAAC,EAAA,OAAAxB,EAAAC,EAAAC,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EACiBG,EAAQ+H,IAAI,OAAQ1E,GADrC,cACED,EADFzD,EAAAI,KAAAJ,EAAAE,KAAA,EAEQuD,EAAOlD,OAFf,UAIE8C,EAAS,KAAM,cAAeI,EAAO6B,QAAQC,YAJ/CmD,EAMqCjF,EAAOmC,SAAS,CAAEH,OAAQ,IAC1DI,UACArD,IAAI,SAACsD,GAAD,OAAOA,EAAEC,QAAQC,QAR1B2C,EAAA/G,OAAAkG,EAAA,EAAAlG,CAAA8G,EAAA,GAMStH,EANTuH,EAAA,GAMsBtH,EANtBsH,EAAA,GAUOvH,EAVP,CAAApB,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,GAYuBG,EAAQ0H,SAAS,WAAYrE,GAZpD,QAYIH,EAZJvD,EAAAI,KAaIqD,EAAOoD,IAAItD,EAAW+B,QAAQC,YAblCvF,EAAAE,KAAA,wBAAAF,EAAAE,KAAA,GAe0BG,EAAQ0H,SAAS3G,GAf3C,QAeOmC,EAfPvD,EAAAI,KAAA,WAiBOiB,EAjBP,CAAArB,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,GAmBmBG,EAAQ2H,KAAK,WAAYtE,GAnB5C,QAmBIF,EAnBJxD,EAAAI,KAoBIqD,EAAOoD,IAAIrD,EAAO8B,QAAQC,YApB9BvF,EAAAE,KAAA,wBAAAF,EAAAE,KAAA,GAsBsBG,EAAQ2H,KAAK3G,GAtBnC,QAsBOmC,EAtBPxD,EAAAI,KAAA,eAAAJ,EAAAE,KAAA,GAyBQqD,EAAWhD,OAzBnB,eA0BE8C,EAAS,KAAM,WAAYe,KAC3Bb,EAAW0E,OAAOC,GAAG,QAAS,kBAAM7E,EAAS,KAAM,WAAYe,OA3BjEpE,EAAAE,KAAA,GA8BQsD,EAAOjD,OA9Bf,QA+BE8C,EAAS,KAAM,WAAYgB,KAC3Bb,EAAOyE,OAAOC,GAAG,QAAS,kBAAM7E,EAAS,KAAM,WAAYgB,OAhC7D,yBAAArE,EAAAS,SAAAf,EAAAgB,UATaI,MAAAJ,KAAAK,YASE4C,EATF,kBAAAC,EAAA9C,MAAAJ,KAAAK,YAAA2D,EAAAzE,KAAA,GAAAyE,EAAAxE,KAAA,GA8KGC,cA9KH,QA8KXR,EA9KW+E,EAAAtE,KAAAsE,EAAAxE,KAAA,wBAAAwE,EAAAzE,KAAA,GAAAyE,EAAAkE,GAAAlE,EAAA,UAiLXrB,EAAS,2BAjLEqB,EAAAlE,OAAA,yBAqLb8C,EAAO3D,EAAM2D,KACbjD,EAAUV,EAAMU,QAChBqD,EAAS/D,EAAM+D,OAEfmF,YAAYrE,EAAgB,KAzLfE,EAAAlE,OAAA,SA2LNW,EACL,CAAEZ,KAAMsD,EAAYU,iBAAgBD,eACpC,CAAE/D,KAAMoD,EAAUI,cAAaC,YAAWE,iBAAgBK,iBAAgBD,gBA7L/D,yBAAAI,EAAAjE,SAAA2C,EAAA1C,KAAA,0XCGf,IAAMoI,EAAc,cACdC,EAAkB,kBAClBC,EAAgB,gBAChBC,EAAoB,oBACpBC,EAAsB,sBACtBC,EAAkB,kBAClBC,EAAgB,gBAChBC,EAAc,cACdC,EAAkB,kBAClBC,EAAkB,kBAClBC,EAAgB,gBAEhBC,EAAaC,iBAAO,CACxBC,WAAY,KACZC,SAAU,KACV5B,KAAM,KACN6B,SAAUC,cAAI,IACdC,UAAW,KACXhH,KAAM,KACNiH,YAAaF,cAAI,CACfG,MAAM,EACNjC,MAAM,EACNkC,aAAcJ,cAAI,CAACK,MAAO,EAAGC,QAAS,IACtCC,aAAcP,cAAI,CAACK,MAAO,EAAGC,QAAS,MAExC7H,QAAQ,EACR+H,UAAU,IAGNC,EAAeT,gBAEd,SAASU,IACd,sBAAAvJ,EAAAW,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KAAO,SAAAlF,EAAe+K,GAAf,IAAAlI,EAAAmI,EAAAC,EAAAC,EAAAC,EAAAC,EAAA/H,EAAA,OAAAlD,EAAAC,EAAAC,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EACgB+B,IADhB,OAQL,IAPMM,EADDvC,EAAAI,KAAAsK,GAAA,EAAAC,GAAA,EAAAC,OAAAjF,EAAA3F,EAAAC,KAAA,EAQL4K,EAAmBtI,EAAnBwI,OAAAnF,cAAA8E,GAAAI,EAAAD,EAAA3K,QAAA8K,MAAAN,GAAA,EAAW3H,EAAgB+H,EAAA9E,MACzByE,EAASQ,EAAWlI,IATjB/C,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAA4I,GAAA5I,EAAA,SAAA2K,GAAA,EAAAC,EAAA5K,EAAA4I,GAAA,QAAA5I,EAAAC,KAAA,GAAAD,EAAAC,KAAA,GAAAyK,GAAA,MAAAG,EAAAK,QAAAL,EAAAK,SAAA,WAAAlL,EAAAC,KAAA,IAAA0K,EAAA,CAAA3K,EAAAE,KAAA,eAAA0K,EAAA,eAAA5K,EAAAmL,OAAA,mBAAAnL,EAAAmL,OAAA,6BAAAnL,EAAAS,SAAAf,EAAAgB,KAAA,+BAAP,gBAAAE,GAAA,OAAAK,EAAAH,MAAAJ,KAAAK,YAAA,GAcK,SAASqK,EAAgBrI,GAC9B,sBAAAsI,EAAAzJ,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KAAO,SAAA8C,EAAe+C,EAAUa,GAAzB,IAAAC,EAAAC,EAAAC,EAAA,OAAA5L,EAAAC,EAAAC,KAAA,SAAA8H,GAAA,cAAAA,EAAA5H,KAAA4H,EAAA3H,MAAA,OACCqL,EAAQD,IAAWI,MAAM/J,IAAIoB,GAC7ByI,EAAWD,EAAKvD,KAAK2D,QAAQ5I,KAC7B0I,EAAUF,EAAK5B,WAAWrF,YAAYkH,GAC5Cf,EAASmB,EAAgB7I,EAAM0I,IAJ1B,wBAAA5D,EAAApH,SAAAiH,EAAAhH,SAAP,gBAAAiC,EAAAC,GAAA,OAAAyI,EAAAvK,MAAAJ,KAAAK,YAAA,GAQK,SAAS8K,EAAI9I,EAAMR,GACxB,sBAAAuJ,EAAAlK,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KAAO,SAAA5D,EAAeyJ,GAAf,OAAA5K,EAAAC,EAAAC,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,OACLwC,EAAQK,EAAMR,GACdkI,EAASsB,EAAchJ,EAAMR,IAFxB,wBAAAb,EAAAjB,SAAAO,EAAAN,SAAP,gBAAAuG,GAAA,OAAA6E,EAAAhL,MAAAJ,KAAAK,YAAA,GAMK,SAASR,EAAKwC,EAAMR,GACzB,sBAAAyJ,EAAApK,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KAAO,SAAAzC,EAAesI,EAAUa,GAAzB,IAAAnK,EAAAwI,EAAA,OAAA9J,EAAAC,EAAAC,KAAA,SAAAqC,GAAA,cAAAA,EAAAnC,KAAAmC,EAAAlC,MAAA,WACDoL,IAAWI,MAAM/J,IAAIoB,GADpB,CAAAX,EAAAlC,KAAA,eAAAkC,EAAA5B,OAAA,SACkC2H,QAAQ8D,KAAR,QAAAC,OAAqBnJ,EAArB,4EADlC,cAEL0H,EAAS0B,EAAWpJ,IACd5B,EAHD,YAAA+K,OAG2BnJ,EAH3B,SAAAX,EAAAlC,KAAA,EAIoBgD,EAAmB,mBAAAkJ,EAAArL,UAAA2E,OAAI2G,EAAJ,IAAAC,MAAAF,GAAAG,EAAA,EAAAA,EAAAH,EAAAG,IAAIF,EAAJE,GAAAxL,UAAAwL,GAAA,OAAaC,EAAe1L,WAAf,EAAmBuL,EAAnBH,OAAA,CAAyBnJ,EAAM0H,EAAUa,MAAWnK,EAAa4B,GAJrH,OAIC4G,EAJDvH,EAAAhC,KAKLqK,EAASgC,EAAkB1J,EAAM4G,IACjCc,EAASiC,GAAY3J,IACjBR,GAAQkI,EAASsB,EAAchJ,GAAM,IACzC4G,EAAWpJ,OARN,yBAAA6B,EAAA3B,SAAA0B,EAAAzB,SAAP,gBAAA6F,EAAAoG,GAAA,OAAAX,EAAAlL,MAAAJ,KAAAK,YAAA,GAYF,SAASkK,EAAWlI,GAClB,sBAAA6J,EAAAhL,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KAAO,SAAA9B,EAAe2H,EAAUa,GAAzB,OAAAzL,EAAAC,EAAAC,KAAA,SAAAkD,GAAA,cAAAA,EAAAhD,KAAAgD,EAAA/C,MAAA,OACDoL,IAAWI,MAAM/J,IAAIoB,GAAO0H,EAASsB,EAAchJ,GAAM,IACxD0H,EAASlK,EAAKwC,GAAM,IAFpB,wBAAAE,EAAAxC,SAAAqC,EAAApC,SAAP,gBAAAmM,EAAAC,GAAA,OAAAF,EAAA9L,MAAAJ,KAAAK,YAAA,GAMK,SAASgM,IACd,IAAIpD,EAAa,KACb5G,EAAO,KACX,sBAAAiK,EAAApL,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KAAO,SAAA4B,EAAeiE,EAAUa,GAAzB,OAAAzL,EAAAC,EAAAC,KAAA,SAAA6G,GAAA,cAAAA,EAAA3G,KAAA2G,EAAA1G,MAAA,cAAA0G,EAAA1G,KAAA,EACcgD,EAAmB,SAAC+J,EAAKC,EAAQC,GAClD,GAAIF,EAAK,OAAQT,EAAgBS,EAAKC,EAAQC,EAAKpK,EAAM0H,EAAUa,GACnE,GAAe,gBAAX4B,EAA0B,CAC5B,IAAM5H,EAAU6H,EAChBpK,EAAOuC,EAAQ8H,MAAM,KAAK,GAC1B3C,EAAS0B,EAAWpJ,IACpB0H,EAAS4C,EAActK,GAAM,IAC7B0H,EAASiC,GAAY3J,IACrB0H,EAAS6C,EAAcvK,EAAMuC,IAC7BmF,EAASgC,EAAkB1J,EAAM4G,SAG5B5G,GAAMoF,QAAQoF,MAAM,qBACzBf,EAAgBS,EAAKC,EAAQC,EAAKpK,EAAM0H,EAAUa,KAdjD,QACL3B,EADK/C,EAAAxG,MAiBMG,OAjBN,wBAAAqG,EAAAnG,SAAA+F,EAAA9F,SAAP,gBAAA8M,EAAAC,GAAA,OAAAT,EAAAlM,MAAAJ,KAAAK,YAAA,GAqBF,SAASyL,EAAiBS,EAAKC,EAAQC,EAAKpK,EAAM0H,EAAUa,GAC1D,GAAI2B,EAAK,OAAOxC,EAASiD,YAAsBT,IAC/C,OAAOC,GACL,IAAK,cACHzC,EAAS6C,EAAcvK,EAAMoK,IAC7B,MACF,IAAK,WACH1C,EA4EN,SAAyB1H,EAAM6G,GAC7B,MAAO,CAAE+D,KAAM1E,EAAmBW,WAAU7G,QA7E/B6K,CAAgB7K,EAAMoK,IAC/B,MACF,IAAK,WACH1C,EAqEN,SAAuB1H,EAAMiF,GAC3B,MAAO,CAAE2F,KAAM3E,EAAehB,OAAMjF,QAtEvB8K,CAAc9K,EAAMoK,IAC7B,MACF,IAAK,YACH1C,EAASqD,GAAe/K,EAAMoK,GAAK,IACnC,MACF,IAAK,aACH,IAAM5B,EAAOD,IAAWI,MAAM/J,IAAIoB,GAC5BgL,EAAWxC,EAAK3B,UAAY2B,EAAK3B,SAASoE,IAAI,QAApC,GAAA9B,OAAkDX,EAAK3B,SAASjI,IAAI,QAApE,4BAAwG,0BACxHwG,QAAQC,IAAI,eAAgB2F,GAC5BtD,EAASwD,YAAgB,CAAEC,SAAUnL,EAAMgL,aAC3CtD,EAASqD,GAAe/K,EAAMoK,GAAK,KAOlC,SAASgB,EAAWjN,EAAUkN,GACnC,OAAO,SAAS3D,EAAUa,GACxB,IACM+C,EADa/C,IAAWI,MAAM/J,IAAIT,GAAUyI,WACnBpF,eAAe6J,GAC1CC,GAAeA,EAAYtL,OAASqL,GAAa3D,EAgEzD,SAAoBvJ,EAAUkN,EAAaE,GACzC,MAAO,CAAEX,KAAMtE,EAAanI,WAAUkN,cAAaE,WAjEaC,CAAWrN,EAAUkN,EAAaC,EAAYtI,QAAQC,SAOjH,SAASwI,EAAkBvC,GAChC,OAAO,SAASxB,EAAUa,GACGA,IAAWI,MAAM+C,KAAK,SAAAC,GAAC,OAAIA,EAAEpE,WAAUX,WAC/C5F,YAAYkI,IAI5B,SAAS0C,EAATC,GAAsD,IAA3BnI,EAA2BmI,EAA3BnI,MAAOC,EAAoBkI,EAApBlI,YAAaC,EAAOiI,EAAPjI,KACpD,OAAO,SAAS8D,EAAUa,GACGA,IAAWI,MAAM+C,KAAK,SAAAC,GAAC,OAAIA,EAAEpE,WAAUX,WAC/C3F,UAAU,CAACyC,QAAOC,cAAaC,UAI/C,SAASkI,EAAoB9L,GAClC,OAAO,SAAS0H,EAAUa,GACGA,IAAWI,MAAM+C,KAAK,SAAAC,GAAC,OAAIA,EAAEpE,WAAUX,WAC/CzF,eAAenB,IAItC,SAAS6I,EAAgB7I,EAAMiF,GAC7B,MAAO,CAAE2F,KAAMnE,EAAexB,OAAMjF,QAGtC,SAASoJ,EAAWpJ,GAClB,MAAO,CAAE4K,KAAM7E,EAAa/F,QAG9B,SAASgJ,EAAchJ,EAAMR,GAC3B,MAAO,CAAEoL,KAAMrE,EAAiBvG,OAAMR,UAGxC,SAASkK,EAAkB1J,EAAM4G,GAC/B,MAAO,CAAEgE,KAAMzE,EAAqBS,aAAY5G,QAGlD,SAASuK,EAAcvK,EAAMuC,GAC3B,MAAO,CAAEqI,KAAM5E,EAAiBhG,OAAMuC,WAWxC,SAAS+H,EAActK,EAAMuH,GAC3B,MAAO,CAAEqD,KAAMxE,EAAiBmB,WAAUvH,QAG5C,SAAS2J,GAAY3J,GACnB,MAAO,CAAE4K,KAAMvE,EAAerG,QAOhC,SAAS+K,GAAe5M,EAAU4N,EAAU9I,GAC1C,MAAO,CAAE2H,KAAMpE,EAAiBrI,WAAU4N,WAAU9I,SAGvC,SAAS+I,KAAsC,IAA9BC,EAA8BjO,UAAA2E,OAAA,QAAAC,IAAA5E,UAAA,GAAAA,UAAA,GAAtBwJ,EAAc0E,EAAQlO,UAAA2E,OAAA,EAAA3E,UAAA,QAAA4E,EAC5D,OAAQsJ,EAAOtB,MACb,KAAK7E,EACH,OAAOkG,EAAMrN,IAAIsN,EAAOlM,MAAQiM,EAAQA,EAAM7H,IAAI8H,EAAOlM,KAAM,IAAI0G,GACrE,KAAKP,EACH,OAAO8F,EAAME,MAAM,CAACD,EAAOlM,KAAM,cAAekM,EAAOtF,YACzD,KAAKZ,EACH,OAAOiG,EAAME,MAAM,CAACD,EAAOlM,KAAM,aAAckM,EAAO3J,SACxD,KAAKkE,EACH,OAAOwF,EAAMG,SAAS,CAACF,EAAOlM,KAAM,QAAS,SAAAqM,GAAO,OAAIA,EAAQC,QAARvO,MAAAsO,EAAOxN,OAAA0N,EAAA,EAAA1N,CAAYqN,EAAOjH,SACpF,KAAKgB,EACH,OAAOgG,EAAME,MAAM,CAACD,EAAOlM,KAAM,QAASwM,eAAKN,EAAOjH,OACxD,KAAKiB,EACH,OAAO+F,EAAME,MAAM,CAACD,EAAOlM,KAAM,YAAa+G,cAAImF,EAAOrF,WAC3D,KAAKT,EACH,OAAO6F,EAAME,MAAM,CAACD,EAAOlM,KAAM,YAAakM,EAAO3E,UACvD,KAAKlB,EACH,OAAO4F,EAAME,MAAM,CAACD,EAAOlM,KAAM,QAASkM,EAAOlM,MACnD,KAAKuG,EACH,OAAO0F,EAAME,MAAM,CAACD,EAAOlM,KAAM,UAAWkM,EAAO1M,QACrD,KAAK8G,EACH,OAAO2F,EAAME,MAAM,CAACD,EAAO/N,SAAU,WAAY+N,EAAOb,aAAca,EAAOX,SAC/E,KAAK/E,EACH,OAAOyF,EAAME,MAAM,CAACD,EAAO/N,SAAU,cAAe+N,EAAOH,UAAWG,EAAOjJ,OAC/E,QACE,OAAOgJ,gXC7OPQ,EAAUC,SAASC,eAAe,QAiCzBC,wLA7BC7J,GACZA,EAAE8J,6DAIFlP,KAAKmP,KAAKC,iBAAiB,QAASpP,KAAKqP,eAAe,GACxDrP,KAAKmP,KAAKC,iBAAiB,YAAapP,KAAKqP,eAAe,kDAI5DrP,KAAKmP,KAAKG,oBAAoB,QAAStP,KAAKqP,eAAe,GAC3DrP,KAAKmP,KAAKG,oBAAoB,YAAatP,KAAKqP,eAAe,oCAGxD,IAAAE,EAAAvP,KACCwP,EAAaxP,KAAKyP,MAAlBD,SACR,OAAOE,IAASC,aACdC,EAAAxQ,EAAAyQ,cAAA,OAAKC,IAAK,SAAAC,GAAC,OAAIR,EAAKJ,KAAOY,GAAGC,UAAU,SACtCJ,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAW,iBACdJ,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,gBACTR,KAIVV,UAzBcmB,IAAMC,kBCDX,SAASC,EAAT5P,GAA8C,IAAjB0F,EAAiB1F,EAAjB0F,KAAMmK,EAAW7P,EAAX6P,QAChD,OACER,EAAAxQ,EAAAyQ,cAACQ,EAAD,KACET,EAAAxQ,EAAAyQ,cAACS,EAAA,EAAD,CAAeN,UAAU,sBACzBJ,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,oBAAoB/J,GACnC2J,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,uBACZI,IAXTG,EAAA3O,EAAA4O,EAAA,sBAAAC,sDCAIC,yBACAC,GAAY,EACVC,EAAgB,YAEPC,8EAAf,SAAA7J,IAAA,IAAApE,EAAA,OAAAkO,EAAA1R,EAAAC,KAAA,SAAA8H,GAAA,cAAAA,EAAA5H,KAAA4H,EAAA3H,MAAA,OACEiI,QAAQC,IAAI,iBACZiJ,GAAY,GAEN/N,EAAO,IAAImO,EAAOC,KAAK,CAC3BC,KAAM,YACNC,aAAc,CAAEvM,QAAQ,GACxBwM,OAAQ,CACNC,UAAW,CACTC,MAAO,CAGL,mEAMNC,OAAO,KAGJ9J,GAAG,QAAS,SAACpC,GAChBqC,QAAQoF,MAAMzH,GACdmM,EAAanM,KAGfxC,EAAK4E,GAAG,QAARtG,OAAAsQ,EAAA,EAAAtQ,CAAA4P,EAAA1R,EAAA8E,KAAiB,SAAAlF,IAAA,IAAAW,EAAAqD,EAAA,OAAA8N,EAAA1R,EAAAC,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,OACfiI,QAAQ8D,KAAK,gBAEP5L,EAAU,IAAIoR,EAAOU,QAAQ7O,GAC7BI,EAAS,CAEb0O,MAAO,CAAC/R,EAAQgS,IAAIC,UAAU,SAGhCL,EAAa,KADbb,EAAgB,CAAE/Q,UAASqD,SAAQJ,SARpB,wBAAAtD,EAAAS,SAAAf,EAAAgB,UA1BnB,wBAAAmH,EAAApH,SAAAiH,EAAAhH,gCAuCA,SAASuR,EAAanM,EAAGyM,GACvB,QAAAC,EAAA,EAAAA,EAAuBlB,EAAvB5L,OAAA8M,IAAsC,EACpCC,EADqBnB,EAAJkB,IACR1M,EAAGyM,+CAIhB,SAAAvR,EAA2B0R,GAA3B,OAAAlB,EAAA1R,EAAAC,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,OACMkR,GAAesB,EAAG,KAAMtB,GACvBC,GAAWE,IAChBD,EAAcqB,KAAKD,GAHrB,wBAAAhR,EAAAjB,SAAAO,EAAAN,gCAUeP,IAJf,WACE,OAAO,IAAIyS,QAAQ,SAACC,EAASC,GAAV,kDAAqBC,CAAY,SAACjN,EAAGyM,GAAJ,OAAiBzM,EAAIgN,EAAOhN,GAAK+M,EAAQN,klBCvD3FS,EAAW,cAEAC,8EAAf,SAAAvT,IAAA,IAAAC,EAAA,OAAAE,EAAAC,EAAAC,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EACsBC,cADtB,UACQR,EADRK,EAAAI,KAES4S,EAFT,CAAAhT,EAAAE,KAAA,eAAAF,EAAAE,KAAA,EAGuBP,EAAMU,QAAQC,KAAK,SAAU,CAAE4S,QAAS,cAH/D,cAGMF,EAHNhT,EAAAI,KAAAJ,EAAAE,KAAA,EAIY8S,EAASzS,OAJrB,cAAAP,EAAAQ,OAAA,SAMWwS,GANX,yBAAAhT,EAAAS,SAAAf,EAAAgB,gCASO,SAAeyS,EAAtBvS,GAAA,OAAAwS,EAAAtS,MAAAJ,KAAAK,sDAAO,SAAA2G,EAAyB2L,GAAzB,IAAAzT,EAAAoH,EAAA,OAAAnH,EAAAC,EAAAC,KAAA,SAAA8H,GAAA,cAAAA,EAAA5H,KAAA4H,EAAA3H,MAAA,cAAA2H,EAAA3H,KAAA,EACY+S,IADZ,cACCrT,EADDiI,EAAAzH,KAEC4G,EAAMD,KAAKC,MAFZa,EAAA3H,KAAA,EAGCN,EAAGkC,IAAHF,OAAAG,EAAA,EAAAH,CAAA,GAAYyR,EAAZ,CAAmBC,QAAStM,EAAKF,UAAWE,KAH7C,wBAAAa,EAAApH,SAAAiH,EAAAhH,gCAMA,SAAe6S,EAAtB5Q,EAAAC,GAAA,OAAA4Q,EAAA1S,MAAAJ,KAAAK,sDAAO,SAAAC,EAAyB+B,EAAMsQ,GAA/B,IAAAzT,EAAAoH,EAAAyM,EAAAC,EAAAC,EAAA,OAAA9T,EAAAC,EAAAC,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,cAAAwB,EAAAxB,KAAA,EACY+S,IADZ,cACCrT,EADD8B,EAAAtB,KAEC4G,EAAMD,KAAKC,MAFZyM,EAGgB7T,EAAG+B,IAAIoB,GAHvB2Q,EAAA9R,OAAAkG,EAAA,EAAAlG,CAAA6R,EAAA,GAGGE,EAHHD,EAAA,GAAAhS,EAAAxB,KAAA,EAICN,EAAGkC,IAAIF,OAAOC,OAAO8R,EAAUN,EAAO,CAAEC,QAAStM,KAJlD,wBAAAtF,EAAAjB,SAAAO,EAAAN,gCAOA,SAAekT,EAAtB3M,GAAA,OAAA4M,EAAA/S,MAAAJ,KAAAK,sDAAO,SAAAoB,EAA4B2R,GAA5B,IAAAlU,EAAA,OAAAC,EAAAC,EAAAC,KAAA,SAAAqC,GAAA,cAAAA,EAAAnC,KAAAmC,EAAAlC,MAAA,cAAAkC,EAAAlC,KAAA,EACY+S,IADZ,cACCrT,EADDwC,EAAAhC,KAAAgC,EAAAlC,KAAA,EAECN,EAAGmU,IAAID,GAFR,wBAAA1R,EAAA3B,SAAA0B,EAAAzB,gCAKA,SAAesT,IAAtB,OAAAC,EAAAnT,MAAAJ,KAAAK,sDAAO,SAAA+B,IAAA,IAAAlD,EAAAsU,EAAA,OAAArU,EAAAC,EAAAC,KAAA,SAAAkD,GAAA,cAAAA,EAAAhD,KAAAgD,EAAA/C,MAAA,cAAA+C,EAAA/C,KAAA,EACY+S,IADZ,cACCrT,EADDqD,EAAA7C,KAEC8T,EAAStU,EAAGyC,MAAM,SAAAC,GAAC,OAAI,IAAM6R,KAAK,SAACrU,EAAGsU,GAAJ,OAAUtU,EAAEwT,QAAUc,EAAEd,UAF3DrQ,EAAAzC,OAAA,SAGE0T,GAHF,wBAAAjR,EAAAxC,SAAAqC,EAAApC,gCC3BP,IAAM2T,EAAa,aAiBZ,SAASC,EAAYvR,GAC1B,sBAAA+I,EAAAlK,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KAAO,SAAA5D,EAAgByJ,EAAUa,GAA1B,IAAA4I,EAAA,OAAArU,EAAAC,EAAAC,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,cAAAwB,EAAAxB,KAAA,EACC0T,EAAY7Q,GADb,cAAArB,EAAAxB,KAAA,EAEgB8T,IAFhB,OAECE,EAFDxS,EAAAtB,KAGLqK,EAAS8J,EAAUL,IAHd,wBAAAxS,EAAAjB,SAAAO,EAAAN,SAAP,gBAAA6F,EAAAoG,GAAA,OAAAb,EAAAhL,MAAAJ,KAAAK,YAAA,GAeF,SAASwT,EAAUL,GACjB,MAAO,CAAEvG,KAAM0G,EAAYH,UAG7B,IAAMM,EAAe1K,cAAI,CACvB2K,UAAWlF,eAAK,MAGH,SAASR,IAAsC,IAA9BC,EAA8BjO,UAAA2E,OAAA,QAAAC,IAAA5E,UAAA,GAAAA,UAAA,GAAtByT,EAAcvF,EAAQlO,UAAA2E,OAAA,EAAA3E,UAAA,QAAA4E,EAC5D,OAAQsJ,EAAOtB,MACb,IAAK,aACH,OAAOqB,EAAM7H,IAAI,YAAaoI,eAAKN,EAAOiF,SAC5C,QACA,OAAOlF,eCtCI0F,EANDC,YACZC,YAAgBC,GAChB,GACAC,YAAgBC,2DCNH,SAASC,EAAT/T,GAAoD,IAAAgU,EAAAhU,EAApCyP,iBAAoC,IAAAuE,EAAxB,GAAwBA,EAAAC,EAAAjU,EAApBkU,mBAAoB,IAAAD,EAAN,GAAMA,EACjE,OACE5E,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAS,QAAAxE,OAAUwE,GAAa0E,MAAM,MAAMC,OAAO,MAAMC,QAAQ,cAAcC,KAAK,OAAOC,MAAM,8BACpGlF,EAAAxQ,EAAAyQ,cAAA,KAAG4E,YAAaA,GACd7E,EAAAxQ,EAAAyQ,cAAA,QAAMjO,EAAE,6CAA6CiT,KAAK,QAAQE,OAAO,UACzEnF,EAAAxQ,EAAAyQ,cAAA,QAAMmF,GAAG,cAAcC,GAAG,IAAIC,GAAG,MAAMC,GAAG,IAAIJ,OAAO,UACrDnF,EAAAxQ,EAAAyQ,cAAA,QAAMmF,GAAG,cAAcC,GAAG,MAAMC,GAAG,MAAMC,GAAG,MAAMJ,OAAO,uBCF3DK,mLAEF,IAAMC,EAAarV,KAAKyP,MAAMzE,MAAM+C,KAAK,SAAAC,GAAC,OAAIA,EAAEpE,WAC1C0L,EAAaD,EAAaA,EAAWhT,KAAO,KAG5CkT,EAFaF,GAAcA,EAAWnM,UAAYmM,EAAWnM,SAASsM,KAEhD,IAAAhK,OAAO8J,GAAe,WAElD,OACE1F,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,mBACbJ,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,UACbJ,EAAAxQ,EAAAyQ,cAACyE,EAAD,CAAMtE,UAAU,eAChBJ,EAAAxQ,EAAAyQ,cAAC4F,EAAA,EAAD,CAASC,gBAAgB,UAAU1F,UAAU,YAAY2F,GAAG,SAA5D,QAAmF,IACnF/F,EAAAxQ,EAAAyQ,cAAC4F,EAAA,EAAD,CAASC,gBAAgB,UAAU1F,UAAS,aAAAxE,OAAgB8J,EAAyB,GAAZ,YAAkBK,GAAI,CAAEC,SAAUL,EAAWjH,MAAO,CAAEuH,UAAU,KAAzI,OAAgK,IAChKjG,EAAAxQ,EAAAyQ,cAAC4F,EAAA,EAAD,CAASC,gBAAgB,UAAU1F,UAAU,YAAY2F,GAAI,WAA7D,UAAyF,IACzF/F,EAAAxQ,EAAAyQ,cAAC4F,EAAA,EAAD,CAASC,gBAAgB,UAAU1F,UAAU,YAAY2F,GAAG,gBAA5D,SAA2F,aAfhFzF,aA0BrB,IACe4F,EADSC,YAJxB,SAAAxV,GACE,MAAO,CAAEyK,MADyCzK,EAAzByK,MACRgL,cADiCzV,EAAjByV,gBAIXD,CAAyBX,6BCxB3Ca,eACJ,SAAAA,EAAYxG,GAAO,IAAAF,EAAA,OAAArO,OAAAgV,EAAA,EAAAhV,CAAAlB,KAAAiW,IACjB1G,EAAArO,OAAAiV,EAAA,EAAAjV,CAAAlB,KAAAkB,OAAAkV,EAAA,EAAAlV,CAAA+U,GAAAI,KAAArW,KAAMyP,KAIR6G,OAAS,WAAM,IAAAC,EACwBhH,EAAKjB,MAAMkI,OAAxCzQ,EADKwQ,EACLxQ,MAAOC,EADFuQ,EACEvQ,YAAayQ,EADfF,EACeE,KAC5BlH,EAAKE,MAAM1F,SAASkE,YAAiB,CAAClI,QAAOC,cAAaC,KAAMwQ,KAFnD,IAAAC,EAGiBnH,EAAKE,MAA3BkH,EAHKD,EAGLC,QAASC,EAHJF,EAGIE,SACbA,EAAStI,OAASsI,EAAStI,MAAMuH,SAAUc,EAAQE,SAClDtH,EAAKE,MAAMkH,QAAQ1E,KAAK,MAVZ1C,EAanBuH,iBAAmB,kBAAMvH,EAAKwH,SAAS,CAAEP,OAAQ,QAb9BjH,EAenByH,WAAa,SAAAzW,GAAgC,IAA9BwF,EAA8BxF,EAA9BwF,MAAOC,EAAuBzF,EAAvByF,YAAayQ,EAAUlW,EAAVkW,KACjC,IAAK1Q,IAAU0Q,EAAM,OAAOhP,QAAQoF,MAAM,6DAC1C0C,EAAKwH,SAAS,CAAEP,OAAQ,CAACzQ,QAAOC,cAAayQ,WAjB5BlH,EAoBnB0H,gBAAkB,SAAAtM,GAAgC,IJjBxBgI,EIiBN5M,EAA8B4E,EAA9B5E,MAAOC,EAAuB2E,EAAvB3E,YAAayQ,EAAU9L,EAAV8L,KACtC,IAAK1Q,IAAU0Q,EAAM,OAAOhP,QAAQoF,MAAM,6DAC1C0C,EAAKE,MAAM1F,UJnBa4I,EImBQ,CAAC5M,QAAOC,cAAaC,KAAMwQ,GJlB7D,eAAA9L,EAAAzJ,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KAAO,SAAA8C,EAAgB+C,EAAUa,GAA1B,IAAA4I,EAAA,OAAArU,EAAAC,EAAAC,KAAA,SAAA8H,GAAA,cAAAA,EAAA5H,KAAA4H,EAAA3H,MAAA,cAAA2H,EAAA3H,KAAA,EACCiT,EAASE,GADV,cAAAxL,EAAA3H,KAAA,EAEgB8T,IAFhB,OAECE,EAFDrM,EAAAzH,KAGLqK,EAAS8J,EAAUL,IAHd,wBAAArM,EAAApH,SAAAiH,EAAAhH,SAAP,gBAAAkC,EAAAqE,GAAA,OAAAoE,EAAAvK,MAAAJ,KAAAK,YAAA,KImBEkP,EAAKE,MAAMkH,QAAQ1E,KAAK,YAvBP1C,EA0BnB2H,aAAe,WAAM,IAAAC,EACW5H,EAAKE,MAA3BkH,EADWQ,EACXR,QAASC,EADEO,EACFP,SACbA,EAAStI,OAASsI,EAAStI,MAAMuH,SAAUc,EAAQE,SAClDtH,EAAKE,MAAMkH,QAAQ1E,KAAK,MA7BZ1C,EAgCnB6H,WAAa,SAAA7L,GAAI,OAAIgE,EAAKE,MAAM1F,SAAS+D,YAAkBvC,KA9BzDgE,EAAKjB,MAAQ,CAAEkI,OAAQ,MAFNjH,wEAkCT,IAAA8H,EAAArX,KAAAsX,EACoBtX,KAAKyP,MAAzB8H,EADAD,EACAC,SAAUvM,EADVsM,EACUtM,MAElB,IAAKuM,EAAU,CACb,IAAMlC,EAAarK,EAAM+C,KAAK,SAAAC,GAAC,OAAIA,EAAEpE,WACrC,IAAKyL,IAAeA,EAAW/N,KAAM,OAAO,KAC5C,IAAK+N,EAAWnM,SAASsM,KAAM,OAAO5F,EAAAxQ,EAAAyQ,cAAC2H,EAAA,EAAD,CAAU7B,GAAG,aAGrD,OACE/F,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,YACbJ,EAAAxQ,EAAAyQ,cAAC4H,GAAA,EAAD,CACEF,SAAUA,EACVd,KAAMzW,KAAKyP,MAAMgH,KACjB1Q,MAAO/F,KAAKyP,MAAM1J,MAClBC,YAAahG,KAAKyP,MAAMzJ,YACxB0R,SAAU1X,KAAKkX,aACfS,YAAa3X,KAAKiX,gBAClBW,OAAQ5X,KAAKgX,aAEbhX,KAAKsO,MAAMkI,OACT5G,EAAAxQ,EAAAyQ,cAACM,EAAA,EAAD,CACElK,KAAK,sGACLmK,QACER,EAAAxQ,EAAAyQ,cAACD,EAAAxQ,EAAMyY,SAAP,KACEjI,EAAAxQ,EAAAyQ,cAAA,UAAQG,UAAU,mBAAmB8H,QAAS9X,KAAK8W,kBAAnD,UACAlH,EAAAxQ,EAAAyQ,cAAA,UAAQG,UAAU,mBAAmB8H,QAAS,kBAAMT,EAAKJ,gBAAgBI,EAAK/I,MAAMkI,UAApF,iBACA5G,EAAAxQ,EAAAyQ,cAAA,UAAQG,UAAU,SAAS8H,QAAS9X,KAAKsW,QAAzC,cAGJ,aAjEUrG,IAAMC,WA2E9B,IACe6H,GADYhC,YAJ3B,SAAA3K,GACE,MAAO,CAAEJ,MADyBI,EAATJ,QAIA+K,CAAyBE,uBC5E9C+B,4LAEF,OACEpI,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,QACbJ,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,YACbJ,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,YACbJ,EAAAxQ,EAAAyQ,cAAA,iBAAcD,EAAAxQ,EAAAyQ,cAAA,iBAAcD,EAAAxQ,EAAAyQ,cAAA,iBAAcD,EAAAxQ,EAAAyQ,cAAA,iBAAcD,EAAAxQ,EAAAyQ,cAAA,iBAAcD,EAAAxQ,EAAAyQ,cAAA,iBAAcD,EAAAxQ,EAAAyQ,cAAA,kBAEtFD,EAAAxQ,EAAAyQ,cAACyE,EAAD,CAAMG,YAAa,IACnB7E,EAAAxQ,EAAAyQ,cAAA,KAAGG,UAAU,SAAb,gDACAJ,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,SACbJ,EAAAxQ,EAAAyQ,cAACoI,GAAA,EAAD,CAAMjI,UAAU,OAAO2F,GAAG,kGAAiG/F,EAAAxQ,EAAAyQ,cAACS,GAAA,EAAD,MAA3H,IAAsIV,EAAAxQ,EAAAyQ,cAAA,QAAMG,UAAU,YAAhB,wBACtIJ,EAAAxQ,EAAAyQ,cAAA,KAAGqI,OAAO,SAASlI,UAAU,OAAOmI,KAAK,4CAA2CvI,EAAAxQ,EAAAyQ,cAACS,GAAA,EAAD,MAApF,IAAiGV,EAAAxQ,EAAAyQ,cAAA,QAAMG,UAAU,YAAhB,4BAZtFC,IAAMC,YAwB7B,IACekI,GADWrC,YAJ1B,SAAAxV,GACE,MAAO,CAAEyK,MADyBzK,EAATyK,QAID+K,CAAyBiC,+BCvB7CK,uBACJ,SAAAA,EAAY5I,GAAO,IAAAF,EAAA,OAAArO,OAAAgV,EAAA,EAAAhV,CAAAlB,KAAAqY,IACjB9I,EAAArO,OAAAiV,EAAA,EAAAjV,CAAAlB,KAAAkB,OAAAkV,EAAA,EAAAlV,CAAAmX,GAAAhC,KAAArW,KAAMyP,KAIR6I,aAAe,SAAAC,GAAE,OAAIhJ,EAAKwH,SAAS,CAAEyB,SAAUD,KAL5BhJ,EAOnB2D,YAAc,WACZ3D,EAAKE,MAAM1F,SAAS6J,EAAYrE,EAAKjB,MAAMkK,WAC3CjJ,EAAKuH,oBATYvH,EAYnBuH,iBAAmB,kBAAMvH,EAAKwH,SAAS,CAAEyB,SAAU,QAVjDjJ,EAAKjB,MAAQ,CAAEkK,SAAU,MAFRjJ,wEAcV,IAAA8H,EAAArX,KACD+T,EAAY/T,KAAKyP,MAAM+D,OAAOvS,IAAI,aAExC,OACE2O,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,kBAEb+D,EAAUyB,KACV5F,EAAAxQ,EAAAyQ,cAAC4I,GAAA,EAAD,CACEC,YAAa3E,EACb4E,cAAe,SAAAvZ,GAAC,iBAAAoM,OAAepM,EAAEgH,YACjCwS,gBAAiB,iBAAM,SACvBC,SAAU,SAAAzZ,GAAC,OAAIiY,EAAKiB,aAAalZ,EAAEgH,cAErCwJ,EAAAxQ,EAAAyQ,cAACiJ,GAAA,EAAD,CAAWlP,UAAU,IAErB5J,KAAKsO,MAAMkK,SACT5I,EAAAxQ,EAAAyQ,cAACM,EAAA,EAAD,CACElK,KAAK,2CACLmK,QACER,EAAAxQ,EAAAyQ,cAACD,EAAAxQ,EAAMyY,SAAP,KACEjI,EAAAxQ,EAAAyQ,cAAA,UAAQG,UAAU,mBAAmB8H,QAAS9X,KAAK8W,kBAAnD,UACAlH,EAAAxQ,EAAAyQ,cAAA,UAAQG,UAAU,eAAe8H,QAAS9X,KAAKkT,aAA/C,aAGJ,aAvCYjD,IAAMC,YAiD9B,IACe6I,GADYhD,YAJ3B,SAAAxV,GACE,MAAO,CAAEiT,OAD0BjT,EAAViT,SAIAuC,CAAyBsC,aClD9CW,8MACJhC,WAAa,SAAAzW,GAAgC,IAA9BwF,EAA8BxF,EAA9BwF,MAAOC,EAAuBzF,EAAvByF,YAAayQ,EAAUlW,EAAVkW,KACzBrD,EAAc7D,EAAKE,MAAMwJ,MAAMC,OAA/B9F,UACR,IAAKrN,IAAU0Q,EAAM,OAAOhP,QAAQoF,MAAM,6DAC1C0C,EAAKE,MAAM1F,SAASkE,YAAiB,CAAClI,QAAOC,cAAaC,KAAMwQ,KAChElH,EAAKE,MAAM1F,SAAS6J,EAAYR,IAChC7D,EAAKE,MAAMkH,QAAQE,YAGrBI,gBAAkB,SAAAtM,GAAgC,IPYvBtI,EAAMsQ,EOZb5M,EAA8B4E,EAA9B5E,MAAOC,EAAuB2E,EAAvB3E,YAAayQ,EAAU9L,EAAV8L,KAC9BrD,EAAc7D,EAAKE,MAAMwJ,MAAMC,OAA/B9F,UACR,IAAKrN,IAAU0Q,EAAM,OAAOhP,QAAQoF,MAAM,6DAC1C0C,EAAKE,MAAM1F,UPSc1H,EOTQ+Q,EPSFT,EOTa,CAAC5M,QAAOC,cAAaC,KAAMwQ,GPUzE,eAAAnL,EAAApK,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KAAO,SAAAzC,EAAgBsI,EAAUa,GAA1B,IAAA4I,EAAA,OAAArU,EAAAC,EAAAC,KAAA,SAAAqC,GAAA,cAAAA,EAAAnC,KAAAmC,EAAAlC,MAAA,cAAAkC,EAAAlC,KAAA,EACCqT,EAASxQ,EAAMsQ,GADhB,cAAAjR,EAAAlC,KAAA,EAEgB8T,IAFhB,OAECE,EAFD9R,EAAAhC,KAGLqK,EAAS8J,EAAUL,IAHd,wBAAA9R,EAAA3B,SAAA0B,EAAAzB,SAAP,gBAAAmM,EAAAC,GAAA,OAAAd,EAAAlL,MAAAJ,KAAAK,YAAA,KOTEkP,EAAKE,MAAMkH,QAAQE,YAGrBK,aAAe,WACb3H,EAAKE,MAAMkH,QAAQE,kFAGZ,IACCzD,EAAcpT,KAAKyP,MAAMwJ,MAAMC,OAA/B9F,UACFW,EAAY/T,KAAKyP,MAAM+D,OAAOvS,IAAI,aAExC,IAAK8S,IAAcA,EAAUyB,KAAM,OAAO5F,EAAAxQ,EAAAyQ,cAACsJ,GAAA,EAAD,CAAgBlT,KAAK,uBAE/D,IAAM0M,EAAQoB,EAAUhG,KAAK,SAAAnM,GAAC,OAAIA,EAAEwE,UAAUvB,aAAeuO,IAC7D,OAAKT,EAEG/C,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,YACbJ,EAAAxQ,EAAAyQ,cAAC4H,GAAA,EAAD,CACE2B,QAAShG,EACTrN,MAAO4M,EAAM5M,MACbC,YAAa2M,EAAM3M,YACnByQ,KAAM9D,EAAM1M,KACZyR,SAAU1X,KAAKkX,aACfS,YAAa3X,KAAKiX,gBAClBW,OAAQ5X,KAAKgX,cAVNpH,EAAAxQ,EAAAyQ,cAAA,mCA3BOI,IAAMC,WA+CpC,IACemJ,GADkBtD,YAJjC,SAAA3K,GACE,MAAO,CAAEoI,OAD0BpI,EAAVoI,SAIMuC,CAAyBiD,oBCjDnD,SAASM,GAAT/Y,GAA2B,IAARyK,EAAQzK,EAARyK,MACxB,OACE4E,EAAAxQ,EAAAyQ,cAAA,MAAIG,UAAU,YAEVhF,EAAMuO,UAAUzX,IAAI,SAAC+I,EAAM8G,GACzB,IAAM7G,EAAWD,EAAKvD,KAAOuD,EAAKvD,KAAKkS,OAAS,KACxCtQ,EAAa2B,EAAb3B,SACR,OAAKA,EAEH0G,EAAAxQ,EAAAyQ,cAAA,MAAI8B,IAAKA,EAAK3B,UAAU,QACtBJ,EAAAxQ,EAAAyQ,cAAA,MAAIG,UAAU,eAAd,cACAJ,EAAAxQ,EAAAyQ,cAACoI,GAAA,EAAD,CAAMjI,UAAU,eAAe2F,GAAE,IAAAnK,OAAMX,EAAKxI,OAC1CuN,EAAAxQ,EAAAyQ,cAAA,QAAMG,UAAU,YAAY9G,EAASjI,IAAI,UAE3C2O,EAAAxQ,EAAAyQ,cAAA,QAAMG,UAAU,gBAAhB,UAAAxE,OAAqCtC,EAASjI,IAAI,cAEhD6J,EACE8E,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,gBACbJ,EAAAxQ,EAAAyQ,cAAA,MAAIG,UAAU,eAAd,cACAJ,EAAAxQ,EAAAyQ,cAACoI,GAAA,EAAD,CAAMjI,UAAU,gBAAgB2F,GAAE,IAAAnK,OAAMX,EAAKxI,KAAX,KAAAmJ,OAAmBV,EAASzI,OAC1DuN,EAAAxQ,EAAAyQ,cAAA,QAAMG,UAAU,qBAAqBlF,EAAS/E,QAElD6J,EAAAxQ,EAAAyQ,cAAA,QAAMG,UAAU,oBAAhB,UAAAxE,OAAyCiO,aAAW3O,EAAS1E,cAIjEwJ,EAAAxQ,EAAAyQ,cAAA,cAnBgBD,EAAAxQ,EAAAyQ,cAAA,KAAG8B,IAAI,IAAI3B,UAAU,oBAArB,iDCP1B0J,oLAEF,IAAMC,EAAc3Z,KAAKyP,MAAMzE,MAAM4O,OAAO,SAAA5L,GAAC,OAAIA,EAAEnM,SAC7CgY,EAAgB7Z,KAAKyP,MAAMzE,MAAM4O,OAAO,SAAA5L,GAAC,OAAKA,EAAEnM,SAAWmM,EAAEpE,WACnE,OACEgG,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,QACbJ,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,eACbJ,EAAAxQ,EAAAyQ,cAAA,KAAGG,UAAU,gBAAb,wBACE2J,EAAYnE,KACZ5F,EAAAxQ,EAAAyQ,cAACD,EAAAxQ,EAAMyY,SAAP,KACEjI,EAAAxQ,EAAAyQ,cAACiK,GAAD,CAAU9O,MAAO2O,KAEjB/J,EAAAxQ,EAAAyQ,cAAA,KAAGG,UAAU,oBAAb,mCAEJJ,EAAAxQ,EAAAyQ,cAAA,KAAGG,UAAU,gBAAb,oCACE6J,EAAcrE,KACd5F,EAAAxQ,EAAAyQ,cAACD,EAAAxQ,EAAMyY,SAAP,KACEjI,EAAAxQ,EAAAyQ,cAACiK,GAAD,CAAU9O,MAAO6O,KAEjBjK,EAAAxQ,EAAAyQ,cAAA,KAAGG,UAAU,oBAAb,4CAnBYE,aA+B1B,IACe6J,GADchE,YAJ7B,SAAAxV,GACE,MAAO,CAAEyK,MADyBzK,EAATyK,QAIE+K,CAAyB2D,ICjCjCM,uBACnB,SAAAA,EAAYvK,GAAM,IAAAF,EAAA,OAAArO,OAAAgV,EAAA,EAAAhV,CAAAlB,KAAAga,IAChBzK,EAAArO,OAAAiV,EAAA,EAAAjV,CAAAlB,KAAAkB,OAAAkV,EAAA,EAAAlV,CAAA8Y,GAAA3D,KAAArW,KAAMyP,KAIRwK,iBAAmB,SAAC7U,GAAD,OAAOmK,EAAKwH,SAAS,CAAEmD,KAAM9U,EAAE8S,OAAO5S,SALvCiK,EAOlB4K,iBAAmB,SAAC/U,GAAD,OAAOmK,EAAKwH,SAAS,CAAExL,KAAMnG,EAAE8S,OAAO5S,SAPvCiK,EASlB6K,qBAAuB,SAAChV,GAAD,OAAOmK,EAAKwH,SAAS,CAAEH,SAAUxR,EAAE8S,OAAO5S,SAT/CiK,EAWlB8K,aAAe,SAACjV,GAAM,IAAAkV,EACa/K,EAAKjB,MAA9B4L,EADYI,EACZJ,KAAM3O,EADM+O,EACN/O,KAAMqL,EADA0D,EACA1D,SACdsD,GAAQ3O,GAAQqL,GACjBrH,EAAKE,MAAM8K,SAAS,CAAEL,OAAM3O,OAAMqL,cAZvCrH,EAAKjB,MAAQ,CAAE4L,KAAM,GAAI3O,KAAM,GAAIqL,SAAU,GAAI4D,gBAAgB,GAFjDjL,wEA8BhB,IAAMkL,EAAeza,KAAKyP,MAAMyK,KAAO,OAAS,SADzCQ,EAE0B1a,KAAKsO,MAA9B4L,EAFDQ,EAECR,KAAM3O,EAFPmP,EAEOnP,KAAMqL,EAFb8D,EAEa9D,SACd+D,EAAYT,GAAQ3O,GAAQqL,EAClC,OACEhH,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,gBACbJ,EAAAxQ,EAAAyQ,cAAA,SAAOqK,KAAK,OAAOlK,UAAU,qCAAqC1K,MAAO4U,EAAMU,SAAU5a,KAAKia,iBAAkBY,YAAY,uBAC5HjL,EAAAxQ,EAAAyQ,cAAA,SAAOqK,KAAK,WAAWlK,UAAU,yCAAyC1K,MAAOsR,EAAUgE,SAAU5a,KAAKoa,qBAAsBS,YAAY,2BAC5IjL,EAAAxQ,EAAAyQ,cAAA,YAAUiL,UAAW,IAAKC,KAAM,EAAGb,KAAK,OAAOlK,UAAU,wCAAwC1K,MAAOiG,EAAMqP,SAAU5a,KAAKma,iBAAkBU,YAAY,iCAC3JjL,EAAAxQ,EAAAyQ,cAAA,UAAQG,UAAU,sCAAsC8H,QAAS9X,KAAKyP,MAAMiI,UAA5E,UACA9H,EAAAxQ,EAAAyQ,cAAA,UAAQmL,UAAWL,EAAW3K,UAAU,4BAA4B8H,QAAS9X,KAAKqa,cAAeI,uDAtBvEhL,EAAOnB,GAAO,IAMpC4L,EAAyBzK,EAAzByK,KAAM3O,EAAmBkE,EAAnBlE,KAAMqL,EAAanH,EAAbmH,SACdqE,EAAWf,GAAQ3O,GAAQqL,EACjC,OAAKtI,EAAMkM,gBAAkBS,EAAiB,CAAEf,OAAM3O,OAAMqL,WAAU4D,gBAAgB,GAC/E,YA3BmCvK,IAAMC,YCE9CgL,8MAEJb,aAAe,SAAA9O,GACbgE,EAAKE,MAAM1F,SAAS+D,YAAkBvC,IADjB,IAAAmL,EAESnH,EAAKE,MAA3BkH,EAFaD,EAEbC,QAASC,EAFIF,EAEJE,SACbA,EAAStI,OAASsI,EAAStI,MAAMuH,SAAUc,EAAQE,SAClDtH,EAAKE,MAAMkH,QAAQ1E,KAAK,QAG/BiF,aAAe,WAAM,IAAAC,EACW5H,EAAKE,MAA3BkH,EADWQ,EACXR,QAASC,EADEO,EACFP,SACjBnP,QAAQC,IAAIkP,GACRA,EAAStI,OAASsI,EAAStI,MAAMuH,UAAUc,EAAQE,SACvDtH,EAAKE,MAAMkH,QAAQ1E,KAAK,8EAGjB,IAEDoD,EADYrV,KAAKyP,MAAfzE,MACiB+C,KAAK,SAAAC,GAAC,OAAIA,EAAEpE,WAF9BrJ,EAGa8U,GAAcA,EAAWnM,UAAYmM,EAAWnM,SAASsM,KAC9BH,EAAWnM,SAASiS,WAAa,GAAxE5P,EAJDhL,EAICgL,KAAMqL,EAJPrW,EAIOqW,SAAUsD,EAJjB3Z,EAIiB2Z,KAExB,OACItK,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,QACbJ,EAAAxQ,EAAAyQ,cAACuL,GAAD,CAAkBb,SAAUva,KAAKqa,aAAc3C,SAAU1X,KAAKkX,aAAc3L,KAAMA,EAAMqL,SAAUA,EAAUsD,KAAMA,YAxB9FjK,IAAMC,WAkCpC,IACemL,GADkBtF,YAJjC,SAAApL,GACE,MAAO,CAAEK,MADyBL,EAATK,QAIM+K,CAAyBmF,WClC3C,SAASI,KACtB,OACE1L,EAAAxQ,EAAAyQ,cAACoI,GAAA,EAAD,CAAMtC,GAAI,CACFC,SAAU,SACVtH,MAAO,CAAEuH,UAAU,KAEzBjG,EAAAxQ,EAAAyQ,cAAA,UAAQG,UAAU,uBAAsBJ,EAAAxQ,EAAAyQ,cAACS,GAAA,EAAD,YCMxCiL,eACJ,SAAAA,EAAY9L,GAAO,IAAAF,EAAA,OAAArO,OAAAgV,EAAA,EAAAhV,CAAAlB,KAAAub,GACjBhM,EAAArO,OAAAiV,EAAA,EAAAjV,CAAAlB,KAAAkB,OAAAkV,EAAA,EAAAlV,CAAAqa,GAAAlF,KAAArW,KAAMyP,IACNA,EAAM1F,SAASD,eACf2F,EAAM1F,SbfR,eAAAxJ,EAAAW,OAAA+C,EAAA,EAAA/C,CAAA/B,EAAAC,EAAA8E,KAAO,SAAAlF,EAAgB+K,EAAUa,GAA1B,IAAA4I,EAAA,OAAArU,EAAAC,EAAAC,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EACgB8T,IADhB,OACCE,EADDlU,EAAAI,KAELqK,EAAS8J,EAAUL,IAFd,wBAAAlU,EAAAS,SAAAf,EAAAgB,SAAP,gBAAAE,EAAA+B,GAAA,OAAA1B,EAAAH,MAAAJ,KAAAK,YAAA,IagBEoP,EAAM1F,SAASsC,eAJEkD,wEAQjB,OAAIvP,KAAKyP,MAAM5C,MAAM2O,cACnB5L,EAAAxQ,EAAAyQ,cAACM,EAAA,EAAD,CACElK,KAAK,sFACLmK,QACER,EAAAxQ,EAAAyQ,cAACD,EAAAxQ,EAAMyY,SAAP,KACEjI,EAAAxQ,EAAAyQ,cAAA,UAAQG,UAAU,SAAS8H,QAAS,kBAAM2D,OAAO7E,SAAS8E,QAAO,KAAjE,cAMN9L,EAAAxQ,EAAAyQ,cAAC8L,EAAA,EAAD,KACE/L,EAAAxQ,EAAAyQ,cAAC+L,EAAA,EAAD,CAAOC,UAAWC,aArBL5L,aA2BrB,SAAS4L,GAATvb,GAA4BA,EAAZqW,SACd,OACEhH,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,QACbJ,EAAAxQ,EAAAyQ,cAAC+L,EAAA,EAAD,CAAOC,UAAWzG,IAClBxF,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,WACbJ,EAAAxQ,EAAAyQ,cAACkM,EAAA,EAAD,KACEnM,EAAAxQ,EAAAyQ,cAAC+L,EAAA,EAAD,CAAOI,OAAK,EAACH,UAAWI,GAAgBjE,IAAWkE,KAAK,UACxDtM,EAAAxQ,EAAAyQ,cAAC+L,EAAA,EAAD,CAAOI,OAAK,EAACH,UAAWI,GAAgB5D,IAAY6D,KAAK,YACzDtM,EAAAxQ,EAAAyQ,cAAC+L,EAAA,EAAD,CAAOI,OAAK,EAACH,UAAW5F,GAAWiG,KAAK,WACxCtM,EAAAxQ,EAAAyQ,cAAC+L,EAAA,EAAD,CAAOI,OAAK,EAACH,UAAWI,GAAgBvC,IAAcwC,KAAK,iBAC3DtM,EAAAxQ,EAAAyQ,cAAC+L,EAAA,EAAD,CAAOI,OAAK,EAACH,UAAWI,GAAgBf,IAAkBgB,KAAK,aAC/DtM,EAAAxQ,EAAAyQ,cAAC+L,EAAA,EAAD,CAAOI,OAAK,EAACH,UAAW7C,GAAiBkD,KAAK,uBAC9CtM,EAAAxQ,EAAAyQ,cAAC+L,EAAA,EAAD,CAAOI,OAAK,EAACH,UAAWI,GAAgBE,KAAWD,KAAK,gBACxDtM,EAAAxQ,EAAAyQ,cAAC+L,EAAA,EAAD,CAAOI,OAAK,EAACH,UAAWO,KAAaF,KAAK,4BAC1CtM,EAAAxQ,EAAAyQ,cAAC+L,EAAA,EAAD,CAAOC,UAAW,kBAAMjM,EAAAxQ,EAAAyQ,cAACwM,EAAA,EAAD,CAAU1G,GAAG,gBAO/C,SAASsG,GAAgB/L,GACvB,OAAO,SAACT,GAAD,OAAWG,EAAAxQ,EAAAyQ,cAACD,EAAAxQ,EAAMyY,SAAP,KAAgBjI,EAAAxQ,EAAAyQ,cAACyM,GAAD,MAAuB1M,EAAAxQ,EAAAyQ,cAACK,EAAcT,KAO1E,IACe8M,GADSxG,YAJxB,SAAApL,GACE,MAAO,CAAEK,MADgCL,EAAhBK,MACT6B,MADyBlC,EAATkC,QAIVkJ,CAAyBwF,ICzDlCiB,4LARX,OACE5M,EAAAxQ,EAAAyQ,cAAC4M,EAAA,EAAD,CAAUzI,MAAOA,GACfpE,EAAAxQ,EAAAyQ,cAAC6M,GAAD,cAJUxM,cCMEyM,QACW,cAA7BlB,OAAO7E,SAASgG,UAEe,UAA7BnB,OAAO7E,SAASgG,UAEhBnB,OAAO7E,SAASgG,SAAS3D,MACvB,2DCZNvJ,IAASmN,OAAOjN,EAAAxQ,EAAAyQ,cAACiN,GAAD,MAAS/N,SAASC,eAAe,SDuH3C,kBAAmB+N,WACrBA,UAAUC,cAAcC,MAAMC,KAAK,SAAAC,GACjCA,EAAaC,iIEzHb3F,6BACJ,SAAAA,EAAahI,GAAO,IAAAF,EAAA,OAAArO,OAAAmc,EAAA,EAAAnc,CAAAlB,KAAAyX,IAClBlI,EAAArO,OAAAoc,EAAA,EAAApc,CAAAlB,KAAAkB,OAAAqc,EAAA,EAAArc,CAAAuW,GAAApB,KAAArW,KAAMyP,KAQR+N,oBAAsB,SAAC/G,GACtBlH,EAAKwH,SAAS,CAAEN,UAVGlH,EAapBkO,kBAAoB,SAACrY,GACnB,IAAMW,EAAQX,EAAE8S,OAAO5S,MACvBiK,EAAKwH,SAAS,CAAEhR,WAfEwJ,EAkBpBmO,wBAA0B,SAACtY,GACzB,IAAMY,EAAcZ,EAAE8S,OAAO5S,MAC7BiK,EAAKwH,SAAS,CAAE/Q,iBAlBhBuJ,EAAKjB,MAAQ,CACXmI,KAAMlH,EAAKE,MAAMgH,MAAQ,GACzB1Q,MAAOwJ,EAAKE,MAAM1J,OAAS,GAC3BC,YAAauJ,EAAKE,MAAMzJ,aAAe,IALvBuJ,wEAuBV,IAAA8H,EAAArX,KAAA0W,EAC4C1W,KAAKyP,MAAjD8H,EADAb,EACAa,SAAUG,EADVhB,EACUgB,SAAUC,EADpBjB,EACoBiB,YAAaC,EADjClB,EACiCkB,OADjC0C,EAE6Bta,KAAKsO,MAAlCmI,EAFA6D,EAEA7D,KAAM1Q,EAFNuU,EAEMvU,MAAOC,EAFbsU,EAEatU,YACf2X,IAAelH,GAAQ1Q,GAASC,GAEtC,OACE4X,EAAAxe,EAAAyQ,cAAA,OAAKG,UAAU,cAEbuH,EACAqG,EAAAxe,EAAAyQ,cAAA,QAAMG,UAAU,eACbhQ,KAAKsO,MAAMvI,OAGd6X,EAAAxe,EAAAyQ,cAAA,SACEiL,UAAU,KACVD,YAAY,QACZ7K,UAAU,cACV4K,SAAU5a,KAAKyd,kBACfnY,MAAOtF,KAAKsO,MAAMvI,QAGpBwR,EACAqG,EAAAxe,EAAAyQ,cAAA,QAAMG,UAAU,qBACbhQ,KAAKsO,MAAMtI,aAGd4X,EAAAxe,EAAAyQ,cAAA,YACEiL,UAAU,MACVD,YAAY,cACZ7K,UAAU,oBACV4K,SAAU5a,KAAK0d,wBACfpY,MAAOtF,KAAKsO,MAAMtI,cAGpBuR,GAAYvX,KAAKyP,MAAMoO,OACvBD,EAAAxe,EAAAyQ,cAAA,QAAMG,UAAU,gBAAhB,MACK4N,EAAAxe,EAAAyQ,cAACiO,EAAA,EAAD,CAAMnI,GAAI3V,KAAKyP,MAAMoO,OAAOE,KAAM/d,KAAKyP,MAAMoO,OAAO3D,OAGzD,KAEA0D,EAAAxe,EAAAyQ,cAACmO,EAAA5e,EAAD,CACE6e,MAAM,SACN1G,SAAUA,EACVqD,SAAU5a,KAAKwd,oBACflY,MAAOtF,KAAKsO,MAAMmI,KAClByH,QAASzG,EAAOyG,QAChBC,QAAS1G,EAAO0G,QAChBC,OAAQ,OACRvD,YAAa,uBAGdtD,EAQD,KAPEqG,EAAAxe,EAAAyQ,cAAA,OAAKG,UAAU,kBACb4N,EAAAxe,EAAAyQ,cAAA,UAAQG,UAAU,mBAAmB8H,QAASJ,GAA9C,UACAkG,EAAAxe,EAAAyQ,cAAA,UAAQmL,SAAU2C,EAAY3N,UAAU,mBAAmB8H,QAAS,kBAAMH,EAAYN,EAAK/I,SAA3F,SACAsP,EAAAxe,EAAAyQ,cAAA,UAAQmL,SAAU2C,EAAY3N,UAAU,SAAS8H,QAAS,kBAAMF,EAAOP,EAAK/I,SAA5E,oBAhFS2B,IAAMC,YA+F3BuH,EAAOyG,QAAU,CACfG,QAAS,CACP,CAAC,CAAEC,OAAU,KAAM,CAACA,OAAU,MAC9B,CAAC,OAAQ,SAAU,cACnB,CAAC,CAACC,KAAQ,WAAY,CAACA,KAAQ,WAC/B,CAAC,OAAQ,SACT,CAAC,UAEHC,UAAW,CAETC,aAAa,IAOjBhH,EAAO0G,QAAU,CACf,SACA,OAAQ,SAAU,aAClB,OAAQ,SACR,OAAQ,SAGK1G,kECjHAiH,MATf,SAAAne,GAA0B,IAAR0F,EAAQ1F,EAAR0F,KAChB,OACE2J,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,mBACX/J,EAAO2J,EAAAxQ,EAAAyQ,cAAA,SAAK5J,GAAa,KAC3B2J,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,cCJf2O,EAAQ,CACZC,SAAU,WACVC,IAAK,EACLC,OAAQ,EACRC,KAAM,EACNC,MAAO,EACPC,QAAS,OACTC,WAAY,SACZC,eAAgB,UAWHhG,IARf,SAAA5Y,GAAkC,IAAR0F,EAAQ1F,EAAR0F,KACxB,OACE2J,EAAAxQ,EAAAyQ,cAAA,OAAK8O,MAAOA,GACV/O,EAAAxQ,EAAAyQ,cAACuP,EAAD,CAAQnZ,KAAMA,2HCfdoZ,EAAmB,mBAElB,SAAS9R,EAAgB+R,GAC9B,MAAO,CAAErS,KAAM,mBAAoBqS,gBAGtB,SAASjR,IAAkC,IAA1BC,EAA0BjO,UAAA2E,OAAA,QAAAC,IAAA5E,UAAA,GAAAA,UAAA,GAAlBwO,eAAK,IAAKN,EAAQlO,UAAA2E,OAAA,EAAA3E,UAAA,QAAA4E,EACxD,OAAQsJ,EAAOtB,MACb,KAAKoS,EACH,OAAO/Q,EAAMK,QAANzN,OAAAqe,EAAA,EAAAre,CAAA,GAAkBqN,EAAO+Q,aAAzB,CAAuCE,MAAM,KACtD,QACA,OAAOlR,qCCbXiC,EAAA3O,EAAA4O,EAAA,sBAAAxD,IAAAuD,EAAA3O,EAAA4O,EAAA,sBAAAnC,IAAA,IAAAoR,EAAAlP,EAAA,IAEMmP,EAAoB,oBAEnB,SAAS1S,EAAsBT,GACpC,MAAO,CAAEU,KAAM,oBAAqBV,OAGtC,IAAMoT,EAAc3W,iBAAO,CACzBwS,cAAe,OAGF,SAASnN,IAA2C,IAAnCC,EAAmCjO,UAAA2E,OAAA,QAAAC,IAAA5E,UAAA,GAAAA,UAAA,GAA3B,IAAIsf,EAAepR,EAAQlO,UAAA2E,OAAA,EAAA3E,UAAA,QAAA4E,EACjE,OAAQsJ,EAAOtB,MACb,KAAKyS,EACH,OAAOpR,EAAM7H,IAAI,gBAAiB8H,EAAOhC,KAC3C,QACA,OAAO+B,qCCjBXiC,EAAA3O,EAAA4O,EAAA,sBAAAiJ,IAAA,IAAAmG,EAAArP,EAAA,IAAAsP,EAAAtP,EAAAR,EAAA6P,GAEe,SAASnG,EAAWqG,GACjC,OAAOC,IAAO,IAAI1Z,KAAKyZ,GAAO,mDCHhCvP,EAAA3O,EAAA4O,EAAA,sBAAAsI,IAAA,IAAAkH,EAAAzP,EAAA,GAAA0P,EAAA1P,EAAAR,EAAAiQ,GAAAE,EAAA3P,EAAA,KAAAA,EAAA,KAIe,SAASuI,EAATvY,GAAiC,IAAZqJ,EAAYrJ,EAAZqJ,SAClC,OACEqW,EAAA7gB,EAAAyQ,cAAA,OAAKG,UAAU,aACbiQ,EAAA7gB,EAAAyQ,cAAA,KAAGG,UAAU,oBAAb,mCAEEpG,EACCqW,EAAA7gB,EAAAyQ,cAACqQ,EAAA,EAAD,CAAMvK,GAAI,CAAEC,SAAU,SAAUtH,MAAO,CAAEuH,UAAU,KAClDoK,EAAA7gB,EAAAyQ,cAAA,UAAQG,UAAU,UAAlB,eAGF,wCCdRO,EAAA3O,EAAA4O,EAAA,sBAAA2P,IAAA,IAAAH,EAAAzP,EAAA,GAAA0P,EAAA1P,EAAAR,EAAAiQ,GAAAE,EAAA3P,EAAA,KAAA6P,EAAA7P,EAAA,IAAAA,EAAA,KAKe,SAAS4P,EAAT5f,GAAkC,IAAR8B,EAAQ9B,EAAR8B,KACvC,OACE4d,EAAA7gB,EAAAyQ,cAAA,OAAKG,UAAU,kBACbiQ,EAAA7gB,EAAAyQ,cAACuQ,EAAA,EAAD,CAAiBpQ,UAAU,UAC3BiQ,EAAA7gB,EAAAyQ,cAAA,OAAKG,UAAU,WACbiQ,EAAA7gB,EAAAyQ,cAAA,QAAMG,UAAU,QAAQ3N,GAAa,IADvC,8CACsF4d,EAAA7gB,EAAAyQ,cAAA,WADtF,2BACoH,IAAIoQ,EAAA7gB,EAAAyQ,cAACqQ,EAAA,EAAD,CAAMvK,GAAG,SAAT,2BADxH,wHCPN,SAAS0K,EAAcC,GACrB,MACG,MAAQA,GACR,OAASA,GACT,OAASA,GACT,OAASA,yCCCd,IAAMC,EAAK,2CAEUC,6MACnBlI,aAAe,SAAClT,EAAGwI,GACjBxI,EAAEqb,kBACFrb,EAAE8J,iBACFK,EAAKE,MAAMoJ,SAASjL,4EAGb,IAAAyJ,EAAArX,KAAA0W,EAC2D1W,KAAKyP,MAA/DkJ,EADDjC,EACCiC,cAAeC,EADhBlC,EACgBkC,gBAAiBF,EADjChC,EACiCgC,YAAaG,EAD9CnC,EAC8CmC,SACrD,OAAKH,EAAYlD,KAETkD,EAAY5W,IAAI,SAAC8L,EAAS8S,GAChC,IAAMC,EAAeJ,EAAGK,KAAKhT,EAAQ3H,MAC/B4a,EAAWF,EAAeA,EAAa,GAAK,KAC5Cva,EAAYqT,YAAW7L,EAAQxH,WACrC,OACEwJ,EAAAxQ,EAAAyQ,cAACoI,EAAA,EAAD,CAAMtC,GAAIgD,EAAc/K,GAAUoC,UAAU,OAAO2B,IAAK+O,GACtD9Q,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,iBACbJ,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,eAAe5J,GAC5ByS,EAAWjJ,EAAAxQ,EAAAyQ,cAACS,EAAA,EAAD,CAAUN,UAAU,gBAAgB8Q,eAAgB,SAAA1b,GAAC,OAAIiS,EAAKiB,aAAalT,EAAGwI,MAAe,MAE1GiT,EAAWjR,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,yBAAwBJ,EAAAxQ,EAAAyQ,cAAA,OAAKkR,IAAKnT,EAAQ7H,MAAOiK,UAAU,sBAAsBgR,IAAKH,KAAqB,KACvIjR,EAAAxQ,EAAAyQ,cAAA,QAAMG,UAAU,gBAAgBpC,EAAQ7H,OACxC6J,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,sBAAsBpC,EAAQ5H,aAC7C4J,EAAAxQ,EAAAyQ,cAAA,OAAKG,UAAU,iBAAf,SAAAxE,OAAsCoN,EAAgBhL,GAAtD,OAAApC,ODvBK,SAAqBvF,GAMlC,IANmF,IAA3Cgb,EAA2C5gB,UAAA2E,OAAA,QAAAC,IAAA5E,UAAA,GAAAA,UAAA,GAAjC,CAAE6gB,IAAK,IAAKC,GAAId,GAC9De,EAAQ,EACR9P,EAAQ,EACR+P,EAAMpb,EAAKjB,OAAS,EAChBmc,EAAYF,EAAZE,GAAID,EAAQD,EAARC,IAELC,EAAGlb,EAAKqL,KAASA,IACxB,KAAO6P,EAAGlb,EAAKob,KAAOA,IAGtB,IAAK,IAAIX,EAAIpP,EAAOoP,GAAKW,GAAM,CAC7B,KAAOX,GAAKW,IAAQF,EAAGlb,EAAKya,IAAKA,KAEjC,IADAU,IACOV,GAAKW,GAAOF,EAAGlb,EAAKya,IAAKA,MAIlC,IAAMY,EAAUF,EAAQF,EAClBK,EAAiB,GAAVD,EAAe,IAG5B,MAAO,CACLrb,KAHgBub,KAAKC,KAAKH,EAAQI,QAAQ,IAGxB,YAClBJ,QAASA,EACTC,KAAMA,EACNH,MAAOA,GCFmEO,CAAY/T,EAAQ3H,MAAMA,UAftE,YATIgK,IAAMC,uLCEtCiM,sBACJ,SAAAA,EAAY1M,GAAO,IAAAF,EAAArO,OAAAmc,EAAA,EAAAnc,CAAAlB,KAAAmc,IACjB5M,EAAArO,OAAAoc,EAAA,EAAApc,CAAAlB,KAAAkB,OAAAqc,EAAA,EAAArc,CAAAib,GAAA9F,KAAArW,KAAMyP,KAQR6I,aAAe,SAAAC,GAAE,OAAIhJ,EAAKwH,SAAS,CAAEyB,SAAUD,KAT5BhJ,EAWnBqS,cAAgB,WACdrS,EAAKE,MAAM1F,SAASoE,YAAoBoB,EAAKjB,MAAMkK,WACnDjJ,EAAKuH,oBAbYvH,EAgBnBuH,iBAAmB,kBAAMvH,EAAKwH,SAAS,CAAEyB,SAAU,QAhBhCjJ,EAkBnBsS,UAAY,kBAAMtS,EAAKE,MAAM1F,SAASoB,YAAIoE,EAAKE,MAAMwJ,MAAMC,OAAO1Y,UAAU,KAlBzD+O,EAoBnBuS,YAAc,kBAAMvS,EAAKE,MAAM1F,SAASoB,YAAIoE,EAAKE,MAAMwJ,MAAMC,OAAO1Y,UAAU,KApB3D+O,EAsBnBwS,WAAa,kBAAMxS,EAAKE,MAAM1F,SAASW,YAAgB6E,EAAKE,MAAMwJ,MAAMC,OAAO1Y,YAtB5D+O,EAwBnByS,kBAAoB,kBAAMzS,EAAKE,MAAMkH,QAAQ1E,KAAK,WAAY,CAAE4D,UAAU,KAxBvD,IAETrV,EAAa+O,EAAKE,MAAMwJ,MAAMC,OAA9B1Y,SAFS,OAGZiP,EAAMzE,MAAM/J,IAAIT,IACnBiP,EAAM1F,SAASlK,YAAKW,IAEtB+O,EAAKjB,MAAQ,CAAEkK,SAAU,MANRjJ,wEA0BV,IAAA8H,EAAArX,KACCQ,EAAaR,KAAKyP,MAAMwJ,MAAMC,OAA9B1Y,SAEFyhB,EAAcjiB,KAAKyP,MAAMzE,MAAM/J,IAAIT,GAEzC,IAAKuQ,EAAOU,QAAQyQ,eAAf,YAAA1W,OAA0ChL,EAA1C,UAA4D,OAAQod,EAAAxe,EAAAyQ,cAACsS,EAAA,EAAD,CAAgB9f,KAAM7B,IAE/F,IAAKyhB,IAAgBA,EAAY3a,OAAS2a,EAAY/Y,SACpD,OAAO0U,EAAAxe,EAAAyQ,cAACuS,EAAA,EAAD,CAAgBnc,KAAK,oBAG9B,IAAM2D,EAAWqY,EAAYrY,SACvByY,EAAWJ,EAAY3a,MAAQ2a,EAAY3a,KAAKkO,MAAQyM,EAAY3a,KAAKkO,KAAOyM,EAAY3a,KAAK2D,QAAQ1F,QACvG2D,EAAa+Y,EAAb/Y,SACFwP,EAAcuJ,EAAY3a,KAAKgb,UAErC,OACE1E,EAAAxe,EAAAyQ,cAAA,OAAKG,UAAU,iBACb4N,EAAAxe,EAAAyQ,cAAC0S,EAAA,EAAD,CACEC,OAAQxiB,KAAKgiB,kBACb9H,KAAMhR,EAASjI,IAAI,QACnB2V,SAAU1N,EAASjI,IAAI,YACvBsK,KAAMrC,EAASjI,IAAI,QACnBwhB,SAAU7Y,EACV8Y,SAAUT,EAAYpgB,OACtB8gB,MAAO3iB,KAAK6hB,UACZe,QAAS5iB,KAAK8hB,cAEdlY,EAAWgU,EAAAxe,EAAAyQ,cAACgT,EAAA,EAAD,CAAc9E,IAAG,kDAAAvS,OAAoDhL,KAAiB,KAChGkY,EAAYlD,KAEboI,EAAAxe,EAAAyQ,cAACiT,EAAA,EAAD,CACEpK,YAAaA,EACbC,cAAe,SAAAvZ,GAAC,UAAAoM,OAAQhL,EAAR,KAAAgL,OAAoBpM,EAAEiD,OACtCuW,gBAAiB,kBAAMqJ,EAAY/Y,SAASjI,IAAI,SAChD4X,SAAUjP,EAAW,SAAAxK,GAAC,OAAIiY,EAAKiB,aAAalZ,EAAEiD,OAAQ,OALxDub,EAAAxe,EAAAyQ,cAACkT,EAAA,EAAD,CAAWnZ,SAAUA,IAQrB5J,KAAKsO,MAAMkK,SACXoF,EAAAxe,EAAAyQ,cAACmT,EAAA,EAAD,CACE/c,KAAK,6CACLmK,QACEwN,EAAAxe,EAAAyQ,cAAC+N,EAAAxe,EAAMyY,SAAP,KACE+F,EAAAxe,EAAAyQ,cAAA,UAAQG,UAAU,mBAAmB8H,QAAS9X,KAAK8W,kBAAnD,UACA8G,EAAAxe,EAAAyQ,cAAA,UAAQG,UAAU,eAAe8H,QAAS9X,KAAK4hB,eAA/C,aAGJ,KACFS,EAAWzE,EAAAxe,EAAAyQ,cAAA,UAAQG,UAAU,SAAS8H,QAAS9X,KAAK+hB,YAAzC,WAAwE,aA3EtE7R,cAqFvB,IAAM+S,EAAoBlN,YAJ1B,SAAAxV,GACE,MAAO,CAAEyK,MADyBzK,EAATyK,QAID+K,CAAyBoG,GACpC8G,yHC9FTC,qNACJC,cAAgB,WAAM,IAAAzM,EACiBnH,EAAKE,MAAlCiT,EADYhM,EACZgM,SAAUC,EADEjM,EACFiM,MAAOC,EADLlM,EACKkM,QACzBF,EAAWE,IAAYD,6EAGhB,IAAAxL,EACsDnX,KAAKyP,MAA1DyK,EADD/C,EACC+C,KAAMtD,EADPO,EACOP,SAAUrL,EADjB4L,EACiB5L,KAAMkX,EADvBtL,EACuBsL,SAAUD,EADjCrL,EACiCqL,OAAQE,EADzCvL,EACyCuL,SAC1CU,EAAW,cAAA5X,OAAiBkX,EAAW,SAAW,YACxD,OACE9E,EAAAxe,EAAAyQ,cAAA,OAAKG,UAAU,eACb4N,EAAAxe,EAAAyQ,cAAA,OAAKG,UAAU,qBACb4N,EAAAxe,EAAAyQ,cAAA,OAAKG,UAAU,YACXkK,GAEJ0D,EAAAxe,EAAAyQ,cAAA,OAAKG,UAAU,gBACX4G,GAEJgH,EAAAxe,EAAAyQ,cAAA,OAAKG,UAAU,YACXzE,IAGHkX,EAAgF,KAArE7E,EAAAxe,EAAAyQ,cAACwT,EAAA,EAAD,CAAYrT,UAAWoT,EAAatL,QAAS9X,KAAKmjB,gBAC9DV,EACA7E,EAAAxe,EAAAyQ,cAAA,OAAKiI,QAAS0K,EAAQxS,UAAU,mBAAhC,QAGA,aA3BgBE,cAiCXgT,sICjCMI,sBACnB,SAAAA,EAAY7T,GAAO,IAAAF,EAAA,OAAArO,OAAAmc,EAAA,EAAAnc,CAAAlB,KAAAsjB,IACjB/T,EAAArO,OAAAoc,EAAA,EAAApc,CAAAlB,KAAAkB,OAAAqc,EAAA,EAAArc,CAAAoiB,GAAAjN,KAAArW,KAAMyP,KAIR8T,WAAa,WACPxG,UAAUyB,UAAWzB,UAAUyB,UAAUgF,UAAUjU,EAAKE,MAAMsO,KAAKb,KAAK3N,EAAKkU,aAE/ElU,EAAKmU,SAASC,SACd5U,SAAS6U,YAAY,QACrBrU,EAAKkU,eAVUlU,EAcnBkU,WAAa,WACXlU,EAAKwH,SAAS,CAAE8M,QAAQ,IACxBC,WAAW,kBAAMvU,EAAKwH,SAAS,CAAE8M,QAAQ,KAAU,MAhBlCtU,EAmBnBwU,YAAc,kBAAMxU,EAAKmU,SAASM,kBAAkB,EAAGzU,EAAKmU,SAASpe,MAAMN,SAjBzEuK,EAAKjB,MAAQ,CAAEuV,QAAQ,GAFNtU,wEAqBV,IAAA8H,EAAArX,KACP,OACE4d,EAAAxe,EAAAyQ,cAAA,OAAKG,UAAU,gBACb4N,EAAAxe,EAAAyQ,cAAA,OAAKG,UAAU,yBACb4N,EAAAxe,EAAAyQ,cAAA,QAAMG,UAAU,uBACd4N,EAAAxe,EAAAyQ,cAACwT,EAAA,EAAD,MACAzF,EAAAxe,EAAAyQ,cAAA,QAAMG,UAAU,2BAAhB,gDAEF4N,EAAAxe,EAAAyQ,cAAA,OAAKG,UAAU,yBACb4N,EAAAxe,EAAAyQ,cAAA,SAAOG,UAAU,aAAaF,IAAK,SAAAC,GAAC,OAAIsH,EAAKqM,SAAW3T,GAAG+H,QAAS9X,KAAK+jB,YAAaxM,UAAQ,EAACjS,MAAOtF,KAAKyP,MAAMsO,MACjHH,EAAAxe,EAAAyQ,cAAA,UAAQG,UAAU,qBAAqB8H,QAAS9X,KAAKujB,YAArD,SAEF3F,EAAAxe,EAAAyQ,cAAA,QAAMG,UAAS,gBAAAxE,OAAkBxL,KAAKsO,MAAMuV,OAAS,OAAS,KAA9D,oBAlCgC5T,IAAMC,yKCI1CkM,cACJ,SAAAA,EAAY3M,GAAO,IAAAF,EAAA,OAAArO,OAAAmc,EAAA,EAAAnc,CAAAlB,KAAAoc,IACjB7M,EAAArO,OAAAoc,EAAA,EAAApc,CAAAlB,KAAAkB,OAAAqc,EAAA,EAAArc,CAAAkb,GAAA/F,KAAArW,KAAMyP,KAYRhC,WAAa,WACX,IAAI8B,EAAKjB,MAAM2V,eAAf,CADiB,IAGTzjB,EAAa+O,EAAKE,MAAMwJ,MAAMC,OAA9B1Y,SACR,IAAKuQ,EAAOU,QAAQyQ,eAAf,YAAA1W,OAA0ChL,EAA1C,UAA4D,OAAO+O,EAAKwH,SAAS,CAAEkN,gBAAgB,IAExG,IAAK1U,EAAKE,MAAMzE,MAAM/J,IAAIT,GAAW,OAAO+O,EAAKE,MAAM1F,SAASlK,YAAKW,IANpD,IAOTkN,EAAgB6B,EAAKE,MAAMwJ,MAAMC,OAAjCxL,YACFuU,EAAc1S,EAAKE,MAAMzE,MAAM/J,IAAIT,GACnC0jB,EAAgBjC,EAAY3Y,YAAYrI,IAAI,SAAWghB,EAAY3Y,YAAYrI,IAAI,QACnFqG,EAAO2a,EAAcA,EAAY3a,KAAO,KAC9C,GAAKA,EAAL,CAEA,IACM6c,EADWlC,EAAY9Y,SACElI,IAAIyM,IAAgBpG,EAAKyG,KAAK,SAAA3O,GAAC,OAAIA,EAAEiD,OAASqL,IAE7E,OAAIyW,EAAsB5U,EAAKwH,SAAS,CAAEqN,SAAS,EAAOD,kBAErDD,OAAL,EAA2B3U,EAAKE,MAAM1F,SAAS0D,YAAWjN,EAAUkN,OA7BpE6B,EAAKjB,MAAQ,CAAE8V,SAAS,EAAMD,cAAe,KAAMF,gBAAgB,GAFlD1U,mFAMjBvP,KAAKyN,0DAIAzN,KAAKsO,MAAM6V,eAAenkB,KAAKyN,8CAwB7B,IACCjN,EAAaR,KAAKyP,MAAMwJ,MAAMC,OAA9B1Y,SACFyhB,EAAcjiB,KAAKyP,MAAMzE,MAAM/J,IAAIT,GAEzC,GAAIR,KAAKsO,MAAM2V,eAAgB,OAAQrG,EAAAxe,EAAAyQ,cAACsS,EAAA,EAAD,CAAgB9f,KAAM7B,IAC7D,GAAIR,KAAKsO,MAAM8V,QAAS,OAAOxG,EAAAxe,EAAAyQ,cAACwU,EAAA,EAAD,CAAgBpe,KAAK,uBAL7C,IAOCke,EAAkBnkB,KAAKsO,MAAvB6V,cACFle,EAAOqe,IAAUC,SAASJ,EAAcle,MAE9C,OAAQ2X,EAAAxe,EAAAyQ,cAAA,OAAKG,UAAU,YACb4N,EAAAxe,EAAAyQ,cAAC2U,EAAA,EAAD,CACEjN,UAAQ,EACRxR,MAAOoe,EAAcpe,MACrBC,YAAame,EAAcne,YAC3ByQ,KAAMxQ,EACN4X,OAAQ,CAAE3D,KAAM+H,EAAY/Y,SAASjI,IAAI,QAAS8c,IAAG,IAAAvS,OAAMhL,cAnDjDyP,IAAMC,WA6DhC,IAAMuU,EAAuB1O,YAJ7B,SAAAxV,GACE,MAAO,CAAEyK,MADyBzK,EAATyK,QAIE+K,CAAyBqG,GACvCqI","file":"static/js/main.c4a93ee3.chunk.js","sourcesContent":["import getOrbit from './orbit'\r\nlet knownFeedsDb = null\r\n\r\nconst AUTO_GARBAGE_COLLECT = false\r\n\r\nif (AUTO_GARBAGE_COLLECT) removeUnpinnedFeeds()\r\n\r\nasync function getKnownFeeds () {\r\n  const orbit = await getOrbit()\r\n  let db\r\n  if (!knownFeedsDb) { \r\n    db = await orbit.orbitdb.docs('knownFeeds')\r\n    await db.load()\r\n    knownFeedsDb = db\r\n  }\r\n  return knownFeedsDb\r\n}\r\n\r\nasync function removeUnpinnedFeeds () {\r\n  // This will drop the visited but unpinned feeds - acting as an automatic garbage collector.\r\n  const orbit = await getOrbit()\r\n  const db = await getKnownFeeds()\r\n\r\n  const unpinned = db.query((doc) => !doc.pinned)\r\n  for (const dbAddr of unpinned) {\r\n    let unpinnedDb\r\n    unpinnedDb = await orbit.orbitdb.open(dbAddr.userAddress)\r\n    unpinnedDb.drop()\r\n    unpinnedDb = await orbit.orbitdb.open(dbAddr.metaAddress)\r\n    unpinnedDb.drop()\r\n    unpinnedDb = await orbit.orbitdb.open(dbAddr.feedAddress)\r\n    unpinnedDb.drop()\r\n    db.del(dbAddr._id)\r\n  }\r\n}\r\n\r\nexport async function saveKnownFeed({userHash, userAddress, metaAddress, feedAddress}) {\r\n  const db = await getKnownFeeds()  \r\n  const newEntry = { userAddress, metaAddress, feedAddress }\r\n  const dbEntry = db.get(userHash)\r\n  const oldEntry = dbEntry ? dbEntry[0] : {}\r\n  const updatedEntry = Object.assign({}, oldEntry, newEntry)\r\n  await db.put({ _id: userHash, ...updatedEntry })\r\n}\r\n\r\nexport async function getPinnedFeeds() {\r\n  const db = await getKnownFeeds()\r\n  return db.query(d => d.pinned).map(f => f._id)\r\n}\r\n\r\nexport async function pinFeed(hash, pinned) {\r\n  const db = await getKnownFeeds()\r\n  const entry = db.get(hash)[0]\r\n  await db.put(Object.assign({}, entry, { pinned }))\r\n}","import getOrbit from './orbit'\r\nimport { saveKnownFeed } from './knownFeeds'\r\n\r\nexport default async function createFeedInstance(callback, userAddress, userHash) {\r\n  \r\n  let ipfs\r\n  let userMetaDb\r\n  let feedDb\r\n  let userDb\r\n  let orbitdb\r\n  let access\r\n    \r\n  async function loadSelf() {\r\n    userDb = await orbitdb.log('user', access) // Create it; this is the current user\r\n    await userDb.load()\r\n\r\n    callback(null, 'userAddress', userDb.address.toString())\r\n\r\n    const [metaAddress, feedAddress] = userDb.iterator({ limit: -1 }) // We want to get the first two and ignore the rest. This might not be ok TODO\r\n      .collect()\r\n      .map((e) => e.payload.value)\r\n    \r\n    if (!metaAddress) {\r\n      // The current user has logged in for the first time; let's create the metadata\r\n      userMetaDb = await orbitdb.keyvalue('userMeta', access)\r\n      userDb.add(userMetaDb.address.toString())\r\n    }\r\n    else userMetaDb = await orbitdb.keyvalue(metaAddress)\r\n\r\n    if (!feedAddress) {\r\n      // The current user has logged in for the first time; let's create the new feed\r\n      feedDb = await orbitdb.feed('userFeed', access)\r\n      userDb.add(feedDb.address.toString())\r\n    }\r\n    else feedDb = await orbitdb.feed(feedAddress)\r\n\r\n    // Set listeners to the user metadata\r\n    await userMetaDb.load()\r\n    callback(null, 'userMeta', getUserMeta())\r\n    userMetaDb.events.on('write', () => callback(null, 'userMeta', getUserMeta()))\r\n\r\n    // Set listeners to the user feed\r\n    await feedDb.load()\r\n    callback(null, 'userFeed', getUserFeed())\r\n    feedDb.events.on('write', () => callback(null, 'userFeed', getUserFeed()))\r\n  }\r\n  \r\n  async function loadRemote() {\r\n    userDb = await orbitdb.log(userAddress, { sync: true, replicate: true, create: true })\r\n    \r\n    userDb.events.on('replicated', replicateData)\r\n    userDb.events.on('replicate.progress', (address, hash, entry, progress, have) => console.log('REPLICATE progress', address, hash, entry, progress, have) )\r\n    \r\n    callback(null, 'userAddress', userDb.address.toString())\r\n    \r\n    async function replicateData() {\r\n      if (userMetaDb && feedDb) return\r\n      \r\n      const [metaAddress, feedAddress] = userDb.iterator({ limit: -1 }) // TODO this\r\n      .collect()\r\n      .map((e) => e.payload.value)\r\n\r\n      if (!metaAddress || !feedAddress) return\r\n      \r\n      // Replicate feed and meta\r\n      userMetaDb = await orbitdb.keyvalue(metaAddress)\r\n      feedDb = await orbitdb.feed(feedAddress)\r\n      \r\n      saveKnownFeed({ userHash, userAddress, metaAddress, feedAddress })\r\n\r\n      userMetaDb.events.on('replicated', () => {\r\n        console.log('meta REPLICATED!')\r\n        renderMeta()\r\n        callback(null, 'replicated', 'meta')\r\n      })\r\n      \r\n      userMetaDb.events.on('replicate', () => {\r\n        console.log('meta REPLICATE!')\r\n        callback(null, 'replicate', 'meta')\r\n      })\r\n      \r\n      userMetaDb.events.on('meta ready', (address) => { console.log('READY', address, userDb)})\r\n      userMetaDb.events.on('meta replicate.progress', (address, hash, entry, progress, have) => console.log('REPLICATE progress', address, hash, entry, progress, have) )\r\n\r\n      feedDb.events.on('replicated', () => {\r\n        console.log('feedDb REPLICATED!')\r\n        renderFeed()\r\n        callback(null, 'replicated', 'feed')\r\n      })\r\n      \r\n      feedDb.events.on('replicate', () => {\r\n        console.log('feedDb REPLICATE!')\r\n        callback(null, 'replicate', 'feed')\r\n      })\r\n      \r\n      feedDb.events.on('feedDb ready', (address) => { console.log('READY', address, userDb)})\r\n      feedDb.events.on('feedDb replicate', (address) => console.log('REPLICATE', address) )\r\n      feedDb.events.on('feedDb replicate.progress', (address, hash, entry, progress, have) => console.log('REPLICATE progress', address, hash, entry, progress, have) )\r\n      \r\n      await userMetaDb.load()\r\n      await feedDb.load()\r\n      \r\n      renderMeta()\r\n      renderFeed()\r\n    }\r\n    \r\n    async function renderMeta() {\r\n      if (!userMetaDb) return\r\n      callback(null, 'userMeta', getUserMeta())\r\n    }\r\n    \r\n    async function renderFeed() {\r\n      if (!feedDb) return\r\n      callback(null, 'userFeed', getUserFeed())\r\n    }\r\n    \r\n    await userDb.load()\r\n    replicateData()\r\n  }\r\n\r\n  function setUserMeta(userMeta) {\r\n    // Write on the user meta db; this is only for the current user\r\n    if (!userMetaDb) return callback('NO_USER_META')\r\n    if (userAddress) return callback('INVALID_OPERATION_SET_META')\r\n    userMetaDb.set('value', userMeta)\r\n  }\r\n\r\n  async function addToFeed({title, description, text}) {\r\n    // Write on the user feed db; this is only for the current user\r\n    if (!feedDb) return callback('NO_USER_FEED')\r\n    // Not creating another keyvalue here; this has the advantage of making deeplinking easier but the disdvantage of having - possibly - a lot of stuff to download\r\n    // Also, articles can be edited only by deleting them and re-publishing them. Order can't be chosen.\r\n    feedDb.add({ createdAt: Date.now(), text, title, description })\r\n  }\r\n  \r\n  async function deleteFromFeed(hash) {\r\n    // Delete on the user feed db; this is only for the current user\r\n    if (!feedDb) return callback('NO_USER_FEED')\r\n    feedDb.remove(hash)\r\n  }\r\n\r\n  function getUserMeta() {\r\n    if (!userMetaDb) return callback('NO_USER_META')\r\n    return userMetaDb.get('value')\r\n  }\r\n\r\n  function getUserFeed(limit = 10) {\r\n    if (!feedDb) return callback('NO_USER_FEED')\r\n    const feedLen = Object.keys(feedDb._index._index).length\r\n    return feedDb.iterator({ limit })\r\n        .collect()\r\n        .map(e => ({ ...e.payload.value, hash: e.hash, next: e.next.length, feedLen }))\r\n  }\r\n  \r\n  function getFeedPage(lt, limit = 10) {\r\n    if (!feedDb) return callback('NO_USER_FEED')\r\n    return feedDb.iterator({ limit, lt })\r\n        .collect()\r\n        .map(e => ({ ...e.payload.value, hash: e.hash, next: e.next.length  }))\r\n  }\r\n  \r\n  function getUserArticle(hash) {\r\n    if (!feedDb) return callback('NO_USER_FEED')\r\n    return feedDb.get(hash)\r\n  }\r\n  \r\n  async function broadcastPeers() {\r\n    if (!ipfs || !userDb || !feedDb || !userMetaDb ) return\r\n    const networkPeers = await ipfs.swarm.peers()\r\n    const userDbPeers = await ipfs.pubsub.peers(userDb.address.toString())\r\n    const feedDbPeers = await ipfs.pubsub.peers(feedDb.address.toString())\r\n    const userMetaDbPeers = await ipfs.pubsub.peers(userMetaDb.address.toString())\r\n    callback(null, 'peers', {networkPeers, userDbPeers, feedDbPeers, userMetaDbPeers}) // TODO connect it to something :)\r\n  }\r\n  \r\n  let orbit\r\n  try {\r\n    orbit = await getOrbit()\r\n  }\r\n  catch (e) {\r\n    callback('ERROR_INITIALIZING_IPFS')\r\n    return\r\n  }\r\n  \r\n  ipfs = orbit.ipfs\r\n  orbitdb = orbit.orbitdb\r\n  access = orbit.access\r\n  \r\n  setInterval(broadcastPeers, 10000)\r\n  \r\n  return userAddress ? \r\n    { load: loadRemote, getUserArticle, getFeedPage } \r\n  : { load: loadSelf, setUserMeta, addToFeed, deleteFromFeed, getUserArticle, getFeedPage }\r\n}\r\n","import { Map, List, Record } from 'immutable'\r\nimport createFeedInstance from '../services/feed.js'\r\nimport { getPinnedFeeds, pinFeed } from '../services/knownFeeds.js'\r\nimport { addNotification } from './notifications.js'\r\nimport { setUnrecoverableError } from './error.js'\r\n\r\nconst CREATE_USER = 'CREATE_USER'\r\nconst SET_USERDB_ADDR = 'SET_USERDB_ADDR'\r\nconst SET_USER_FEED = 'SET_USER_FEED'\r\nconst SET_USER_METADATA = 'SET_USER_METADATA'\r\nconst SET_USERDB_INSTANCE = 'SET_USERDB_INSTANCE'\r\nconst SET_USER_MASTER = 'SET_USER_MASTER'\r\nconst SET_USER_HASH = 'SET_USER_HASH'\r\nconst ADD_ARTICLE = 'ADD_ARTICLE'\r\nconst SET_USER_PINNED = 'SET_USER_PINNED'\r\nconst SET_REPLICATION = 'SET_REPLICATION'\r\nconst ADD_USER_FEED = 'ADD_USER_FEED'\r\n\r\nconst UserRecord = Record({\r\n  dbInstance: null,\r\n  metadata: null,\r\n  feed: null,\r\n  articles: Map({}),\r\n  dbAddress: null,\r\n  hash: null,\r\n  replication: Map({\r\n    meta: false,\r\n    feed: false,\r\n    metaProgress: Map({total: 0, current: 0}),\r\n    feedProgress: Map({total: 0, current: 0}),\r\n  }),\r\n  pinned: false,\r\n  isMaster: false\r\n})\r\n\r\nconst initialUsers = Map()\r\n\r\nexport function init() {\r\n  return async function(dispatch) {\r\n    const pinned = await getPinnedFeeds()\r\n    // Load and replicate the pinned ones\r\n    // Please note that the unpinned, but already-replicated ones are still in the db.\r\n    // They won't be replicated but they will be *not* garbage collected\r\n    // One possibility is waiting for garbage collection\r\n    // Another is make the user manually garbage collect them.\r\n    // For now, we just ignore them.\r\n    for (const hash of pinned) {\r\n      dispatch(loadPinned(hash))\r\n    }\r\n  }\r\n}\r\n\r\nexport function advanceFeedPage(hash) {\r\n  return async function(dispatch, getState) {\r\n    const user = (getState().users.get(hash))\r\n    const lastPost = user.feed.first().hash\r\n    const newPage = user.dbInstance.getFeedPage(lastPost)\r\n    dispatch(addUserFeedPage(hash, newPage))\r\n  }\r\n}\r\n\r\nexport function pin(hash, pinned) {\r\n  return async function(dispatch) {\r\n    pinFeed(hash, pinned)\r\n    dispatch(setUserPinned(hash, pinned))\r\n  }\r\n}\r\n\r\nexport function load(hash, pinned) {\r\n  return async function(dispatch, getState) {\r\n    if (getState().users.get(hash)) return console.info(`hash ${hash} requested, but it was already loaded (probably because it was pinned)`)\r\n    dispatch(createUser(hash))\r\n    const userAddress = `/orbitdb/${hash}/user`\r\n    const dbInstance = await createFeedInstance((...args) => handleDbMessage(...args, hash, dispatch, getState), userAddress, hash)\r\n    dispatch(setUserDbInstance(hash, dbInstance))\r\n    dispatch(setUserHash(hash))\r\n    if (pinned) dispatch(setUserPinned(hash, true))\r\n    dbInstance.load()\r\n  }\r\n}\r\n\r\nfunction loadPinned(hash) {\r\n  return async function(dispatch, getState) {\r\n    if (getState().users.get(hash)) dispatch(setUserPinned(hash, true))\r\n    else dispatch(load(hash, true))\r\n  }\r\n}\r\n\r\nexport function loadMaster() {\r\n  let dbInstance = null\r\n  let hash = null\r\n  return async function(dispatch, getState) {\r\n    dbInstance = await createFeedInstance((err, status, arg) => {\r\n      if (err) return (handleDbMessage(err, status, arg, hash, dispatch, getState))\r\n      if (status === 'userAddress') {\r\n        const address = arg\r\n        hash = address.split('/')[2]\r\n        dispatch(createUser(hash))\r\n        dispatch(setUserMaster(hash, true))\r\n        dispatch(setUserHash(hash))\r\n        dispatch(setUserDbAddr(hash, address))\r\n        dispatch(setUserDbInstance(hash, dbInstance))\r\n      }\r\n      else {\r\n        if (!hash) console.error('RACE CONDITION!!!')\r\n        handleDbMessage(err, status, arg, hash, dispatch, getState)\r\n      }\r\n    })\r\n    dbInstance.load()\r\n  }\r\n}\r\n\r\nfunction handleDbMessage (err, status, arg, hash, dispatch, getState) {\r\n  if (err) return dispatch(setUnrecoverableError(err))\r\n  switch(status) {\r\n    case 'userAddress':\r\n      dispatch(setUserDbAddr(hash, arg))\r\n      break\r\n    case 'userMeta':\r\n      dispatch(setUserMetadata(hash, arg))\r\n      break\r\n    case 'userFeed':\r\n      dispatch(setUserDbFeed(hash, arg))\r\n      break\r\n    case 'replicate':\r\n      dispatch(setReplication(hash, arg, true))\r\n      break\r\n    case 'replicated':\r\n      const user = getState().users.get(hash)\r\n      const message = (user.metadata && user.metadata.has('name')) ? `${user.metadata.get('name')}'s feed was just updated` : 'A feed was just updated'\r\n      console.log('notification', message)\r\n      dispatch(addNotification({ feedLink: hash, message }))\r\n      dispatch(setReplication(hash, arg, false))\r\n      break\r\n    default:\r\n      break\r\n  }\r\n}\r\n\r\nexport function getArticle(userHash, articleHash) {\r\n  return function(dispatch, getState) {\r\n    const dbInstance = getState().users.get(userHash).dbInstance\r\n    const articleData = dbInstance.getUserArticle(articleHash)\r\n    if (articleData && articleData.hash === articleHash) dispatch(addArticle(userHash, articleHash, articleData.payload.value))\r\n    // There are two cases here. If articleData is undefined, we don't have anything for this feed (yet)\r\n    // If articleData.hash !== articleHash, we have this feed stored, but the article is not found, so the first one is returned\r\n  }\r\n}\r\n\r\n\r\nexport function setMasterMetadata(info) {\r\n  return function(dispatch, getState) {\r\n    const masterUserInstance = getState().users.find(u => u.isMaster).dbInstance\r\n    masterUserInstance.setUserMeta(info)\r\n  }\r\n}\r\n\r\nexport function addMasterArticle({title, description, text}) {\r\n  return function(dispatch, getState) {\r\n    const masterUserInstance = getState().users.find(u => u.isMaster).dbInstance\r\n    masterUserInstance.addToFeed({title, description, text})\r\n  }\r\n}\r\n\r\nexport function deleteMasterArticle(hash) {\r\n  return function(dispatch, getState) {\r\n    const masterUserInstance = getState().users.find(u => u.isMaster).dbInstance\r\n    masterUserInstance.deleteFromFeed(hash)\r\n  }\r\n}\r\n\r\nfunction addUserFeedPage(hash, feed) {\r\n  return { type: ADD_USER_FEED, feed, hash }\r\n}\r\n\r\nfunction createUser(hash) {\r\n  return { type: CREATE_USER, hash }\r\n}\r\n\r\nfunction setUserPinned(hash, pinned) {\r\n  return { type: SET_USER_PINNED, hash, pinned }\r\n}\r\n\r\nfunction setUserDbInstance(hash, dbInstance) {\r\n  return { type: SET_USERDB_INSTANCE, dbInstance, hash }\r\n}\r\n\r\nfunction setUserDbAddr(hash, address) {\r\n  return { type: SET_USERDB_ADDR, hash, address }\r\n}\r\n\r\nfunction setUserDbFeed(hash, feed) {\r\n  return { type: SET_USER_FEED, feed, hash }\r\n}\r\n\r\nfunction setUserMetadata(hash, metadata) {\r\n  return { type: SET_USER_METADATA, metadata, hash }\r\n}\r\n\r\nfunction setUserMaster(hash, isMaster) {\r\n  return { type: SET_USER_MASTER, isMaster, hash }\r\n}\r\n\r\nfunction setUserHash(hash) {\r\n  return { type: SET_USER_HASH, hash }\r\n}\r\n\r\nfunction addArticle(userHash, articleHash, article) {\r\n  return { type: ADD_ARTICLE, userHash, articleHash, article }\r\n}\r\n\r\nfunction setReplication(userHash, dataType, value) {\r\n  return { type: SET_REPLICATION, userHash, dataType, value }\r\n}\r\n\r\nexport default function reducer(state = initialUsers, action) {\r\n  switch (action.type) {\r\n    case CREATE_USER:\r\n      return state.get(action.hash) ? state : state.set(action.hash, new UserRecord())\r\n    case SET_USERDB_INSTANCE:\r\n      return state.setIn([action.hash, 'dbInstance'], action.dbInstance)\r\n    case SET_USERDB_ADDR:\r\n      return state.setIn([action.hash, 'dbAddress'], action.address)\r\n    case ADD_USER_FEED:\r\n      return state.updateIn([action.hash, 'feed'], oldFeed => oldFeed.unshift(...action.feed))\r\n    case SET_USER_FEED:\r\n      return state.setIn([action.hash, 'feed'], List(action.feed))\r\n    case SET_USER_METADATA:\r\n      return state.setIn([action.hash, 'metadata'], Map(action.metadata))\r\n    case SET_USER_MASTER:\r\n      return state.setIn([action.hash, 'isMaster'], action.isMaster)\r\n    case SET_USER_HASH:\r\n      return state.setIn([action.hash, 'hash'], action.hash)\r\n    case SET_USER_PINNED:\r\n      return state.setIn([action.hash, 'pinned'], action.pinned)\r\n    case ADD_ARTICLE:\r\n      return state.setIn([action.userHash, 'articles', action.articleHash], action.article)\r\n    case SET_REPLICATION:\r\n      return state.setIn([action.userHash, 'replication', action.dataType], action.value)\r\n    default:\r\n      return state\r\n  }\r\n}\r\n","import './Modal.css'\r\nimport React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nconst appRoot = document.getElementById('root')\r\n\r\n\r\nclass Modal extends React.Component {\r\n  preventScroll(e) { \r\n    e.preventDefault()\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.node.addEventListener('wheel', this.preventScroll, false)\r\n    this.node.addEventListener('touchmove', this.preventScroll, false)\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.node.removeEventListener('wheel', this.preventScroll, false)\r\n    this.node.removeEventListener('touchmove', this.preventScroll, false)\r\n  }\r\n  \r\n  render() {\r\n    const { children } = this.props\r\n    return ReactDOM.createPortal(\r\n      <div ref={n => this.node = n} className=\"Modal\">\r\n        <div className={\"ModalBackdrop\"}>\r\n          <div className=\"ModalContent\">\r\n              { children }\r\n          </div>\r\n        </div>\r\n      </div>,\r\n      appRoot\r\n    )\r\n  }\r\n}\r\n\r\nexport default Modal","import React from 'react'\r\nimport { FiAlertCircle } from 'react-icons/fi'\r\nimport Modal from './Modal'\r\nimport './ConfirmationModal.css'\r\n\r\nexport default function ConfirmationModal({ text, buttons }) {\r\n  return (\r\n    <Modal>\r\n      <FiAlertCircle className=\"confirmationAlert\"/>\r\n      <div className=\"confirmationText\">{text}</div>\r\n      <div className=\"confirmationButtons\">\r\n        {buttons}\r\n      </div>\r\n    </Modal>\r\n  )\r\n} ","let orbitInstance\r\nlet isLoading = false\r\nconst resolverQueue = []\r\n\r\nasync function initOrbit() {\r\n  console.log('Starting IPFS')\r\n  isLoading = true\r\n\r\n  const ipfs = new global.Ipfs({\r\n    repo: '/vitriol/',\r\n    EXPERIMENTAL: { pubsub: true },\r\n    config: {\r\n      Addresses: {\r\n        Swarm: [\r\n          // Use IPFS dev signal server\r\n          // '/dns4/ws-star.discovery.libp2p.io/tcp/443/wss/p2p-websocket-star',\r\n          '/dns4/star-signal.cloud.ipfs.team/udp/443/wss/p2p-webrtc-star',\r\n          // Use local signal server\r\n          // '/ip4/0.0.0.0/tcp/9090/wss/p2p-webrtc-star',\r\n        ]\r\n      },\r\n    },\r\n    start: true\r\n  })\r\n\r\n  ipfs.on('error', (e) => {\r\n    console.error(e)\r\n    consumeQueue(e)\r\n  })\r\n\r\n  ipfs.on('ready', async () => {\r\n    console.info(\"IPFS Started\")\r\n\r\n    const orbitdb = new global.OrbitDB(ipfs)\r\n    const access = {\r\n      // Give write access to ourselves\r\n      write: [orbitdb.key.getPublic('hex')]\r\n    }\r\n    orbitInstance = { orbitdb, access, ipfs }\r\n    consumeQueue(null, orbitInstance)\r\n  })\r\n}\r\n\r\nfunction consumeQueue(e, instance) {\r\n  for (const resolver of resolverQueue) {\r\n    resolver(e, instance)\r\n  }\r\n}\r\n\r\nasync function createOrbit(cb) {\r\n  if (orbitInstance) cb(null, orbitInstance)\r\n  if (!isLoading) initOrbit()\r\n  resolverQueue.push(cb)\r\n}\r\n\r\nfunction getOrbit() {\r\n  return new Promise((resolve, reject) => createOrbit((e, instance) => e ? reject(e) : resolve(instance)))\r\n}\r\n\r\nexport default getOrbit","import getOrbit from './orbit'\r\nlet draftsDb = null\r\n\r\nasync function getDraftsDb () {\r\n  const orbit = await getOrbit()\r\n    if (!draftsDb) { \r\n      draftsDb = await orbit.orbitdb.docs('drafts', { indexBy: 'createdAt' })\r\n      await draftsDb.load()\r\n    }\r\n    return draftsDb\r\n}\r\n\r\nexport async function addDraft (draft) {\r\n  const db = await getDraftsDb()\r\n  const now = Date.now()\r\n  await db.put({ ...draft, savedAt: now, createdAt: now })\r\n}\r\n\r\nexport async function putDraft (hash, draft) {\r\n  const db = await getDraftsDb()\r\n  const now = Date.now()\r\n  const [ oldDraft ] = db.get(hash)\r\n  await db.put(Object.assign(oldDraft, draft, { savedAt: now }))\r\n}\r\n\r\nexport async function removeDraft (draftHash) {\r\n  const db = await getDraftsDb()\r\n  await db.del(draftHash)\r\n}\r\n\r\nexport async function queryDrafts() {\r\n  const db = await getDraftsDb()\r\n  const drafts = db.query(d => true).sort((a, b) => a.savedAt < b.savedAt)\r\n  return drafts\r\n}","import { List, Map } from 'immutable'\r\nimport { queryDrafts, addDraft, putDraft, removeDraft } from '../services/drafts'\r\n\r\nconst SET_DRAFTS = 'SET_DRAFTS'\r\n\r\nexport function initDrafts() {\r\n  return async function (dispatch, getState) {\r\n    const drafts = await queryDrafts()\r\n    dispatch(setDrafts(drafts))\r\n  }\r\n}\r\n\r\nexport function insertDraft(draft) {\r\n  return async function (dispatch, getState) {\r\n    await addDraft(draft)\r\n    const drafts = await queryDrafts()\r\n    dispatch(setDrafts(drafts))\r\n  }\r\n}\r\n\r\nexport function deleteDraft(hash) {\r\n  return async function (dispatch, getState) {\r\n    await removeDraft(hash)\r\n    const drafts = await queryDrafts()\r\n    dispatch(setDrafts(drafts))\r\n  }\r\n}\r\n\r\nexport function replaceDraft(hash, draft) {\r\n  return async function (dispatch, getState) {\r\n    await putDraft(hash, draft)\r\n    const drafts = await queryDrafts()\r\n    dispatch(setDrafts(drafts))\r\n  }\r\n}\r\n\r\nfunction setDrafts(drafts) {\r\n  return { type: SET_DRAFTS, drafts }\r\n}\r\n\r\nconst initialState = Map({\r\n  draftList: List([])\r\n})\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case 'SET_DRAFTS':\r\n      return state.set('draftList', List(action.drafts))\r\n    default:\r\n    return state\r\n  }\r\n}","import { createStore, applyMiddleware } from 'redux'\r\nimport { combineReducers } from 'redux'\r\nimport thunkMiddleware from 'redux-thunk'\r\nimport * as reducers from './duck'\r\n\r\nconst store = createStore(\r\n  combineReducers(reducers),\r\n  {},\r\n  applyMiddleware(thunkMiddleware)\r\n)\r\n\r\nexport default store","import React from 'react'\r\n\r\nexport default function Logo({ className = '', strokeWidth = 10 }) {\r\n  return (\r\n    <svg className={`Logo ${className}`} width=\"202\" height=\"201\" viewBox=\"0 0 202 201\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      <g strokeWidth={strokeWidth}>\r\n        <path d=\"M192.799 32L101 191L9.20131 32L192.799 32Z\" fill=\"white\" stroke=\"black\"/>\r\n        <line x1=\"3.49691e-07\" y1=\"4\" x2=\"200\" y2=\"4\" stroke=\"black\"/>\r\n        <line x1=\"4.37114e-07\" y1=\"100\" x2=\"200\" y2=\"100\" stroke=\"black\"/>\r\n      </g>\r\n    </svg>\r\n  )\r\n}","import React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { NavLink } from 'react-router-dom'\r\nimport Logo from '../components/Logo'\r\nimport './Header.css'\r\n\r\nclass Header extends Component {\r\n  render() {\r\n    const masterUser = this.props.users.find(u => u.isMaster)\r\n    const masterHash = masterUser ? masterUser.hash : null\r\n    const hasProfile = masterUser && masterUser.metadata && masterUser.metadata.size\r\n      \r\n    const toProfile = hasProfile ? `/${masterHash}` : '/profile'\r\n    \r\n    return (\r\n      <div className=\"HeaderContainer\">\r\n        <div className=\"Header\">\r\n          <Logo className=\"HeaderLogo\" />\r\n          <NavLink activeClassName=\"current\" className=\"ButtonTab\" to=\"/home\">Home</NavLink>{' '}\r\n          <NavLink activeClassName=\"current\" className={`ButtonTab ${!masterHash ? 'disabled': ''}`} to={{ pathname: toProfile, state: { internal: true }}}>You</NavLink>{' '}\r\n          <NavLink activeClassName=\"current\" className=\"ButtonTab\" to={'/drafts'}>Drafts</NavLink>{' '}\r\n          <NavLink activeClassName=\"current\" className=\"ButtonTab\" to=\"/connections\">Feeds</NavLink>{' '}\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nfunction mapStateToProps({ users,  notifications }) {\r\n  return { users,  notifications }\r\n}\r\n\r\nconst ConnectedHeader = connect(mapStateToProps)(Header)\r\nexport default ConnectedHeader","import React from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { Redirect } from 'react-router'\r\nimport { addMasterArticle, setMasterMetadata } from '../duck/users'\r\nimport { insertDraft } from '../duck/drafts'\r\nimport Editor from '../Editor'\r\nimport ConfirmationModal from '../components/ConfirmationModal'\r\n\r\nclass WritePage extends React.Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = { toSave: null }\r\n  }\r\n  \r\n  doSave = () => {\r\n    const { title, description, html } = this.state.toSave\r\n    this.props.dispatch(addMasterArticle({title, description, text: html}))\r\n    const { history, location } = this.props\r\n    if (location.state && location.state.internal) history.goBack()\r\n    else this.props.history.push('/')\r\n  }\r\n  \r\n  hideConfirmation = () => this.setState({ toSave: null })\r\n  \r\n  handleSave = ({title, description, html}) => {\r\n    if (!title || !html) return console.error('This should be a validation error: no title or no article')\r\n    this.setState({ toSave: {title, description, html} })\r\n  }\r\n  \r\n  handleSaveDraft = ({title, description, html}) => {\r\n    if (!title || !html) return console.error('This should be a validation error: no title or no article')\r\n    this.props.dispatch(insertDraft({title, description, text: html}))\r\n    this.props.history.push('/drafts')\r\n  }\r\n  \r\n  handleCancel = () => {\r\n    const { history, location } = this.props\r\n    if (location.state && location.state.internal) history.goBack()\r\n    else this.props.history.push('/')\r\n  }\r\n  \r\n  handleInfo = info => this.props.dispatch(setMasterMetadata(info))\r\n  \r\n  render () {\r\n    const { readOnly, users } = this.props\r\n    \r\n    if (!readOnly) {\r\n      const masterUser = users.find(u => u.isMaster)\r\n      if (!masterUser || !masterUser.feed) return null\r\n      if (!masterUser.metadata.size) return <Redirect to=\"/profile\" />\r\n    }\r\n    \r\n    return (\r\n      <div className=\"FullPage\">\r\n        <Editor\r\n          readOnly={readOnly}\r\n          html={this.props.html}\r\n          title={this.props.title}\r\n          description={this.props.description}\r\n          onCancel={this.handleCancel}\r\n          onSaveDraft={this.handleSaveDraft}\r\n          onSave={this.handleSave}\r\n        />\r\n        { this.state.toSave ?\r\n            <ConfirmationModal \r\n              text=\"Do you really want to publish this article? It will be visible by anyone who has your feed address.\"\r\n              buttons={(\r\n                <React.Fragment>\r\n                  <button className=\"Button Secondary\" onClick={this.hideConfirmation}>Cancel</button>\r\n                  <button className=\"Button Secondary\" onClick={() => this.handleSaveDraft(this.state.toSave) }>Save as draft</button>\r\n                  <button className=\"Button\" onClick={this.doSave}>Publish</button>\r\n                </React.Fragment>\r\n              )} />\r\n            : null } \r\n      </div>\r\n     )\r\n  }\r\n}\r\n\r\nfunction mapStateToProps({ users }) {\r\n  return { users }\r\n}\r\n\r\nconst ConnectedWritePage = connect(mapStateToProps)(WritePage)\r\nexport default ConnectedWritePage","import React from 'react'\r\nimport { Link } from 'react-router-dom'\r\nimport { connect } from 'react-redux'\r\nimport { FiGitlab, FiBook } from 'react-icons/fi'\r\nimport Logo from '../components/Logo'\r\nimport './HomePage.css'\r\n\r\nclass HomePage extends React.Component {\r\n  render() {        \r\n    return (\r\n      <div className=\"Page\">\r\n        <div className=\"HomePage\">\r\n          <div className=\"LogoName\">\r\n            <span>V</span><span>I</span><span>T</span><span>R</span><span>I</span><span>O</span><span>L</span>\r\n          </div>\r\n          <Logo strokeWidth={2} />\r\n          <p className=\"Blurb\">Distributed, serverless publishing platform.</p>\r\n          <div className=\"Links\">\r\n            <Link className=\"Link\" to=\"/QmccRaHCrUKZwZpjdJFiTTdgp8FG3ALFDZQexaYgit3NCF/QmYJvZjnw8c1DqFbW1BpWmvb3jVg8fQYRUs6UzzEyosagA\"><FiBook /> <span className=\"LinkText\">Read the user intro</span></Link>\r\n            <a target=\"_blank\" className=\"Link\" href=\"https://gitlab.com/vitriolum/vitriol-web\"><FiGitlab /> <span className=\"LinkText\">Read the code</span></a>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nfunction mapStateToProps({ users }) {\r\n  return { users }\r\n}\r\n\r\nconst ConnectedHomePage = connect(mapStateToProps)(HomePage)\r\nexport default ConnectedHomePage\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { deleteDraft } from '../duck/drafts.js'\r\nimport CardList from '../CardList'\r\nimport EmptyList from '../EmptyList'\r\nimport ConfirmationModal from '../components/ConfirmationModal'\r\nimport './DraftPage.css'\r\n\r\nclass DraftPage extends React.Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = { toDelete: null }\r\n  }\r\n  \r\n  handleDelete = id => this.setState({ toDelete: id })\r\n\r\n  removeDraft = () => {\r\n    this.props.dispatch(deleteDraft(this.state.toDelete))\r\n    this.hideConfirmation()\r\n  }\r\n\r\n  hideConfirmation = () => this.setState({ toDelete: null })\r\n\r\n  render() {\r\n    const draftList = this.props.drafts.get('draftList')\r\n    \r\n    return (\r\n      <div className=\"DraftPage Page\">\r\n      {\r\n        draftList.size ?\r\n        <CardList\r\n          articleList={draftList}\r\n          linkFormatter={a => `/drafts/${a.createdAt}`}\r\n          authorFormatter={() => 'Draft'}\r\n          onDelete={a => this.handleDelete(a.createdAt)}\r\n        /> :\r\n        <EmptyList isMaster={true}/>\r\n      }\r\n      { this.state.toDelete ?\r\n          <ConfirmationModal \r\n            text=\"Do you really want to remove this draft?\"\r\n            buttons={(\r\n              <React.Fragment>\r\n                <button className=\"Button Secondary\" onClick={this.hideConfirmation}>Cancel</button>\r\n                <button className=\"Button Alert\" onClick={this.removeDraft}>Remove</button>\r\n              </React.Fragment>\r\n            )} />\r\n          : null } \r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nfunction mapStateToProps({ drafts }) {\r\n  return { drafts }\r\n}\r\n\r\nconst ConnectedDraftPage = connect(mapStateToProps)(DraftPage)\r\nexport default ConnectedDraftPage","import React from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { addMasterArticle } from '../duck/users'\r\nimport { deleteDraft, replaceDraft } from '../duck/drafts'\r\nimport FullPageLoader from '../components/FullPageLoader'\r\nimport Editor from '../Editor'\r\n\r\nclass DraftEditorPage extends React.Component {\r\n  handleSave = ({title, description, html}) => {\r\n    const { draftHash } = this.props.match.params\r\n    if (!title || !html) return console.error('This should be a validation error: no title or no article')\r\n    this.props.dispatch(addMasterArticle({title, description, text: html}))\r\n    this.props.dispatch(deleteDraft(draftHash))\r\n    this.props.history.goBack()\r\n  }\r\n  \r\n  handleSaveDraft = ({title, description, html}) => {\r\n    const { draftHash } = this.props.match.params\r\n    if (!title || !html) return console.error('This should be a validation error: no title or no article')\r\n    this.props.dispatch(replaceDraft(draftHash, {title, description, text: html}))\r\n    this.props.history.goBack()\r\n  }\r\n  \r\n  handleCancel = () => {\r\n    this.props.history.goBack()\r\n  }\r\n  \r\n  render() {\r\n    const { draftHash } = this.props.match.params\r\n    const draftList = this.props.drafts.get('draftList')\r\n    \r\n    if (!draftList || !draftList.size) return <FullPageLoader text=\"Loading article...\" />\r\n    \r\n    const draft = draftList.find(d => d.createdAt.toString() === draftHash)\r\n    if (!draft) return <p>Draft not found</p>\r\n    \r\n    return (<div className=\"FullPage\">\r\n              <Editor\r\n                draftId={draftHash}\r\n                title={draft.title}\r\n                description={draft.description}\r\n                html={draft.text}\r\n                onCancel={this.handleCancel}\r\n                onSaveDraft={this.handleSaveDraft}\r\n                onSave={this.handleSave}\r\n              />\r\n            </div>)\r\n  }\r\n}\r\n\r\nfunction mapStateToProps({ drafts }) {\r\n  return { drafts }\r\n}\r\n\r\nconst ConnectedDraftEditorPage = connect(mapStateToProps)(DraftEditorPage)\r\nexport default ConnectedDraftEditorPage","import React from 'react'\r\nimport { Link } from 'react-router-dom'\r\nimport formatDate from './utilities/formatDate'\r\nimport './UserList.css'\r\n\r\nexport function UserList({users}) {\r\n  return (\r\n    <ul className=\"UserList\">\r\n      {\r\n        users.toArray().map((user, key) => { \r\n          const lastPost = user.feed ? user.feed.last() : null\r\n          const { metadata } = user\r\n          if (!metadata) return <p key=\"0\" className=\"EmptyPlaceHolder\">There seems to be nothing here.</p>\r\n          return (\r\n            <li key={key} className=\"Card\">\r\n              <h2 className=\"FeedHeading\">Feed name:</h2>\r\n              <Link className=\"FeedNameLink\" to={`/${user.hash}`}>\r\n                <span className=\"FeedName\">{metadata.get('name')}</span>\r\n              </Link>\r\n              <span className=\"FeedLocation\">{`— ${metadata.get('location')}`}</span>\r\n              {\r\n                lastPost ? (\r\n                  <div className=\"FeedLastPost\">\r\n                    <h2 className=\"FeedHeading\">Last post:</h2>\r\n                    <Link className=\"FeedTitleLink\" to={`/${user.hash}/${lastPost.hash}`}>\r\n                        <span className=\"FeedLastPostTitle\">{lastPost.title}</span>\r\n                    </Link>\r\n                    <span className=\"FeedLastPostDate\">{`— ${formatDate(lastPost.createdAt)}`}</span>\r\n                  </div>\r\n                  )\r\n                :\r\n                <span></span>\r\n              }\r\n            </li>\r\n          )\r\n        })\r\n      }\r\n    </ul>\r\n  )\r\n}\r\n","import React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { UserList } from '../UserList'\r\nimport './TrackedPage.css'\r\n\r\nclass TrackedPage extends Component {\r\n  render() {\r\n    const pinnedUsers = this.props.users.filter(u => u.pinned)\r\n    const unpinnedUsers = this.props.users.filter(u => !u.pinned && !u.isMaster)\r\n    return (\r\n      <div className=\"Page\">\r\n        <div className=\"TrackedPage\">\r\n          <p className=\"TrackedTitle\">Feeds you've pinned:</p>\r\n          { pinnedUsers.size ?\r\n            <React.Fragment>\r\n              <UserList users={pinnedUsers} />\r\n            </React.Fragment>\r\n            : <p className=\"EmptyPlaceHolder\">There seems to be nothing here.</p>\r\n          }\r\n          <p className=\"TrackedTitle\">Feeds you track in this session:</p>\r\n          { unpinnedUsers.size ?\r\n            <React.Fragment>\r\n              <UserList users={unpinnedUsers} />\r\n            </React.Fragment>\r\n            : <p className=\"EmptyPlaceHolder\">There seems to be nothing here.</p>\r\n          }\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nfunction mapStateToProps({ users }) {\r\n  return { users }\r\n}\r\n\r\nconst ConnectedTrackedPage = connect(mapStateToProps)(TrackedPage)\r\nexport default ConnectedTrackedPage\r\n\r\n","import React from 'react'\r\nimport './PersonalInfoForm.css'\r\n\r\nexport default class PersonalInfoForm extends React.Component {\r\n  constructor(props){\r\n    super(props)\r\n    this.state = { name: '', info: '', location: '', hasInitialised: false }\r\n  }\r\n  \r\n  handleNameChange = (e) => this.setState({ name: e.target.value })\r\n\r\n  handleInfoChange = (e) => this.setState({ info: e.target.value })\r\n\r\n  handleLocationChange = (e) => this.setState({ location: e.target.value })\r\n\r\n  handleSubmit = (e) => {\r\n    const { name, info, location } = this.state\r\n    if (!(name && info && location)) return\r\n    else this.props.onSubmit({ name, info, location })\r\n  }\r\n  \r\n  static getDerivedStateFromProps(props, state) {\r\n    /* If we get props for the first time, initialise the state with them\r\n       and prevent any further initialisation. This has to be done here\r\n       because personal info from the store comes asynchronously, \r\n       later than first render */\r\n    \r\n    const { name, info, location } = props\r\n    const hasProps = name || info || location\r\n    if (!state.hasInitialised && hasProps) return { name, info, location, hasInitialised: true }\r\n    return null\r\n  }\r\n  \r\n  render() {\r\n    const commitButton = this.props.name ? 'SAVE' : 'CREATE'\r\n    const { name, info, location } = this.state\r\n    const isEnabled = name && info && location\r\n    return (\r\n      <div className=\"PersonalInfo\">\r\n        <input name=\"name\" className=\"PersonalInfoInput PersonalInfoName\" value={name} onChange={this.handleNameChange} placeholder=\"Enter your name...\"/>\r\n        <input name=\"location\" className=\"PersonalInfoInput PersonalInfoLocation\" value={location} onChange={this.handleLocationChange} placeholder=\"Enter your location...\"/>\r\n        <textarea maxLength={250} rows={3} name=\"info\" className=\"PersonalInfoInput PersonalInfoDetails\" value={info} onChange={this.handleInfoChange} placeholder=\"Enter some info about you...\"/>\r\n        <button className=\"Button Secondary PersonalInfoButton\" onClick={this.props.onCancel}>CANCEL</button>  \r\n        <button disabled={!isEnabled} className=\"Button PersonalInfoButton\" onClick={this.handleSubmit}>{commitButton}</button>\r\n    </div>)\r\n  }\r\n}","import React from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { setMasterMetadata } from '../duck/users'\r\nimport PersonalInfoForm from '../PersonalInfoForm'\r\n\r\nclass EditProfilePage extends React.Component {\r\n  \r\n  handleSubmit = info => {\r\n    this.props.dispatch(setMasterMetadata(info))\r\n    const { history, location } = this.props\r\n    if (location.state && location.state.internal) history.goBack()\r\n    else this.props.history.push('/')\r\n  }\r\n  \r\n  handleCancel = () => {\r\n    const { history, location } = this.props\r\n    console.log(location)\r\n    if (location.state && location.state.internal) history.goBack()\r\n    this.props.history.push('/')\r\n  }\r\n  \r\n  render() {\r\n    const { users } = this.props\r\n    const masterUser = users.find(u => u.isMaster)    \r\n    const hasMetadata = masterUser && masterUser.metadata && masterUser.metadata.size\r\n    const { info, location, name } = hasMetadata ? masterUser.metadata.toObject() : {}\r\n        \r\n    return (\r\n        <div className=\"Page\">\r\n          <PersonalInfoForm onSubmit={this.handleSubmit} onCancel={this.handleCancel} info={info} location={location} name={name} />\r\n        </div>\r\n    )\r\n  }\r\n}\r\n\r\nfunction mapStateToProps({ users }) {\r\n  return { users }\r\n}\r\n\r\nconst ConnectedEditProfilePage = connect(mapStateToProps)(EditProfilePage)\r\nexport default ConnectedEditProfilePage\r\n","import React from 'react'\r\nimport { Link } from 'react-router-dom'\r\nimport { FiEdit2 } from 'react-icons/fi'\r\nimport './WriteFloatingButton.css'\r\n\r\nexport default function WriteFloatingButton() {\r\n  return (\r\n    <Link to={{\r\n            pathname: \"/write\",\r\n            state: { internal: true }\r\n          }}>\r\n      <button className=\"WriteFloatingButton\"><FiEdit2 /></button>\r\n    </Link>\r\n    )\r\n}","import React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { BrowserRouter, HashRouter, StaticRouter, Switch, Route, Redirect } from 'react-router-dom'\r\nimport { loadMaster, init } from './duck/users'\r\nimport { initDrafts } from './duck/drafts'\r\nimport ConfirmationModal from './components/ConfirmationModal'\r\nimport Header from './pages/Header'\r\nimport FeedPage from './pages/FeedPage'\r\nimport WritePage from './pages/WritePage'\r\nimport HomePage from './pages/HomePage'\r\nimport ArticlePage from './pages/ArticlePage'\r\nimport DraftPage from './pages/DraftPage'\r\nimport DraftEditorPage from './pages/DraftEditorPage'\r\nimport TrackedPage from './pages/TrackedPage'\r\nimport EditProfilePage from './pages/EditProfilePage'\r\nimport WriteFloatingButton from './components/WriteFloatingButton'\r\n\r\nclass Routes extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    props.dispatch(init())\r\n    props.dispatch(initDrafts())\r\n    props.dispatch(loadMaster())\r\n  }\r\n\r\n  render() {\r\n    if (this.props.error.unrecoverable) return (\r\n      <ConfirmationModal\r\n        text=\"There has been an unrecoverable error connecting to IPFS. Please retry again later.\"\r\n        buttons={(\r\n          <React.Fragment>\r\n            <button className=\"Button\" onClick={() => window.location.reload(true)}>Refresh</button>\r\n          </React.Fragment>\r\n        )} />\r\n    )\r\n\r\n    return (\r\n      <HashRouter>\r\n        <Route component={View} />\r\n      </HashRouter>\r\n    )\r\n  }\r\n}\r\n\r\nfunction View({ location }) {\r\n  return (\r\n    <div className=\"View\">\r\n      <Route component={Header} />\r\n      <div className=\"Content\">\r\n        <Switch>\r\n          <Route exact component={withWriteButton(HomePage)} path=\"/home\" />\r\n          <Route exact component={withWriteButton(DraftPage)} path=\"/drafts\" />\r\n          <Route exact component={WritePage} path=\"/write\" />\r\n          <Route exact component={withWriteButton(TrackedPage)} path=\"/connections\" />\r\n          <Route exact component={withWriteButton(EditProfilePage)} path=\"/profile\" />\r\n          <Route exact component={DraftEditorPage} path=\"/drafts/:draftHash\" />\r\n          <Route exact component={withWriteButton(FeedPage)} path=\"/:userHash/\" />\r\n          <Route exact component={ArticlePage} path=\"/:userHash/:articleHash\" />\r\n          <Route component={() => <Redirect to=\"/home\" />} />\r\n        </Switch>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction withWriteButton(Component) {\r\n  return (props) => <React.Fragment><WriteFloatingButton /><Component {...props} /></React.Fragment>\r\n}\r\n\r\nfunction mapStateToProps({ users, error }) {\r\n  return { users, error }\r\n}\r\n\r\nconst ConnectedRoutes = connect(mapStateToProps)(Routes)\r\nexport default ConnectedRoutes\r\n","import React, { Component } from 'react'\r\nimport { Provider } from 'react-redux'\r\nimport store from './reducers'\r\nimport Routes from './Routes'\r\nimport './App.css'\r\n\r\nclass App extends Component {  \r\n  render() {\r\n    return (\r\n      <Provider store={store}>\r\n        <Routes />\r\n      </Provider>\r\n    )\r\n  }\r\n}\r\n\r\nexport default App\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read http://bit.ly/CRA-PWA.\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      if (\r\n        response.status === 404 ||\r\n        response.headers.get('content-type').indexOf('javascript') === -1\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: http://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n","import React from 'react'\r\nimport ReactQuill from 'react-quill'\r\nimport { Link } from 'react-router-dom'\r\nimport 'react-quill/dist/quill.bubble.css'\r\nimport './Editor.css'\r\n\r\nclass Editor extends React.Component {\r\n  constructor (props) {\r\n    super(props)\r\n    this.state = { \r\n      html: this.props.html || '',\r\n      title: this.props.title || '',\r\n      description: this.props.description || ''\r\n    }\r\n  }\r\n  \r\n  handleArticleChange = (html) => {\r\n  \tthis.setState({ html })\r\n  }\r\n\r\n  handleTitleChange = (e) => {\r\n    const title = e.target.value\r\n    this.setState({ title })\r\n  }\r\n  \r\n  handleDescriptionChange = (e) => {\r\n    const description = e.target.value\r\n    this.setState({ description })\r\n  }\r\n  \r\n  render () {\r\n    const { readOnly, onCancel, onSaveDraft, onSave } = this.props\r\n    const { html, title, description } = this.state\r\n    const isDisabled = !(html && title && description)\r\n    \r\n    return (\r\n      <div className=\"FeedEditor\">\r\n      {\r\n        readOnly ?\r\n        <span className=\"EditorTitle\">\r\n          {this.state.title}\r\n        </span>\r\n      :\r\n        <input\r\n          maxLength=\"80\"\r\n          placeholder=\"Title\"\r\n          className=\"EditorTitle\" \r\n          onChange={this.handleTitleChange} \r\n          value={this.state.title}/>\r\n      }\r\n      { \r\n        readOnly ?\r\n        <span className=\"EditorDescription\">\r\n          {this.state.description}\r\n        </span>\r\n      :\r\n        <textarea \r\n          maxLength=\"255\"\r\n          placeholder=\"Description\"\r\n          className=\"EditorDescription\"\r\n          onChange={this.handleDescriptionChange}\r\n          value={this.state.description}/>\r\n      }\r\n      {\r\n        readOnly && this.props.author ? \r\n        <span className=\"EditorAuthor\">\r\n          by <Link to={this.props.author.url}>{this.props.author.name}</Link>\r\n        </span>\r\n          :\r\n        null\r\n      }\r\n        <ReactQuill \r\n          theme='bubble'\r\n          readOnly={readOnly}\r\n          onChange={this.handleArticleChange}\r\n          value={this.state.html}\r\n          modules={Editor.modules}\r\n          formats={Editor.formats}\r\n          bounds={'.app'}\r\n          placeholder={'Write something...'}\r\n         />\r\n      {  \r\n        !readOnly ? \r\n        ( <div className=\"EditorCommands\">\r\n            <button className=\"Button Secondary\" onClick={onCancel}>CANCEL</button>\r\n            <button disabled={isDisabled} className=\"Button Secondary\" onClick={() => onSaveDraft(this.state)}>DRAFT</button>\r\n            <button disabled={isDisabled} className=\"Button\" onClick={() => onSave(this.state)}>PUBLISH</button>\r\n          </div>\r\n        )\r\n        : \r\n        null\r\n      }\r\n      </div>\r\n     )\r\n  }\r\n}\r\n\r\n/* \r\n * Quill modules to attach to editor\r\n * See https://quilljs.com/docs/modules/ for complete options\r\n */\r\nEditor.modules = {\r\n  toolbar: [\r\n    [{ 'header': '1'}, {'header': '2'}],\r\n    ['bold', 'italic', 'blockquote'],\r\n    [{'list': 'ordered'}, {'list': 'bullet'}],\r\n    ['link', 'image'],\r\n    ['clean']\r\n  ],\r\n  clipboard: {\r\n    // toggle to add extra line breaks when pasting HTML:\r\n    matchVisual: false,\r\n  }\r\n}\r\n/* \r\n * Quill editor formats\r\n * See https://quilljs.com/docs/formats/\r\n */\r\nEditor.formats = [\r\n  'header',\r\n  'bold', 'italic', 'blockquote',\r\n  'list', 'bullet',\r\n  'link', 'image'\r\n]\r\n\r\nexport default Editor","import React from 'react'\r\nimport './Loader.css'\r\n\r\nfunction Loader({ text }) {\r\n  return (\r\n    <div className=\"loaderContainer\">\r\n      { text ? <p>{ text }</p> : null }\r\n      <div className=\"spinner\" /> \r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Loader ","import React from 'react'\r\nimport Loader from './Loader'\r\n\r\nconst style = {\r\n  position: 'absolute',\r\n  top: 0,\r\n  bottom: 0,\r\n  left: 0,\r\n  right: 0,\r\n  display: 'flex',\r\n  alignItems: 'center',\r\n  justifyContent: 'center'\r\n}\r\n\r\nfunction FullPageLoader({ text }) {\r\n  return (\r\n    <div style={style}>\r\n      <Loader text={text} />\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default FullPageLoader ","import { List } from 'immutable'\r\n\r\nconst ADD_NOTIFICATION = 'ADD_NOTIFICATION'\r\n\r\nexport function addNotification(notification) {\r\n  return { type: 'ADD_NOTIFICATION', notification }\r\n}\r\n\r\nexport default function reducer(state = List([]), action) {\r\n  switch (action.type) {\r\n    case ADD_NOTIFICATION:\r\n      return state.unshift({...action.notification, read: false})\r\n    default:\r\n    return state\r\n  }\r\n}","import { Record } from 'immutable'\r\n\r\nconst SET_UNRECOVERABLE = 'SET_UNRECOVERABLE'\r\n\r\nexport function setUnrecoverableError(err) {\r\n  return { type: 'SET_UNRECOVERABLE', err }\r\n}\r\n\r\nconst ErrorRecord = Record({\r\n  unrecoverable: null\r\n})\r\n\r\nexport default function reducer(state = new ErrorRecord(), action) {\r\n  switch (action.type) {\r\n    case SET_UNRECOVERABLE:\r\n      return state.set('unrecoverable', action.err)\r\n    default:\r\n    return state\r\n  }\r\n}","import format from 'date-fns/format'\r\n\r\nexport default function formatDate(date) {\r\n  return format(new Date(date), 'MMMM, Do YYYY')\r\n}","import React from 'react'\r\nimport { Link } from 'react-router-dom'\r\nimport './EmptyList.css'\r\n\r\nexport default function EmptyList({ isMaster }) {\r\n  return (\r\n    <div className=\"EmptyList\">\r\n      <p className=\"EmptyListMessage\">It seems there is nothing here.</p>\r\n      { \r\n        isMaster ? \r\n        (<Link to={{ pathname: \"/write\", state: { internal: true }}}>\r\n          <button className=\"Button\">Write post</button>\r\n        </Link>)\r\n        : \r\n        null\r\n      } \r\n    </div>\r\n  )\r\n}","import React from 'react'\r\nimport { Link } from 'react-router-dom'\r\nimport { FiAlertTriangle } from 'react-icons/fi'\r\nimport './InvalidAddress.css'\r\n\r\nexport default function InvalidAddress({ hash }) {\r\n  return (\r\n    <div className=\"InvalidAddress\">\r\n      <FiAlertTriangle className=\"alert\"/>\r\n      <div className=\"message\">\r\n        <span className=\"name\">{hash}</span>{' '} doesn't seem to be a valid id for a feed. <br/>Please check your URL or{' '}<Link to='/home'>return to the home page</Link>.\r\n      </div>\r\n    </div>\r\n  )\r\n}","// adapted from https://github.com/ngryman/reading-time\r\n\r\nfunction ansiWordBound(c) {\r\n  return (\r\n    (' ' === c) ||\r\n    ('\\n' === c) ||\r\n    ('\\r' === c) ||\r\n    ('\\t' === c)\r\n  )\r\n}\r\n\r\nexport default function readingTime(text, options = { wpm: 200, wb: ansiWordBound }) {\r\n  let words = 0\r\n  let start = 0\r\n  let end = text.length - 1\r\n  const { wb, wpm } = options\r\n\r\n  while (wb(text[start])) start++\r\n  while (wb(text[end])) end--\r\n\r\n  // number of words\r\n  for (let i = start; i <= end;) {\r\n    for (; i <= end && !wb(text[i]); i++) ;\r\n    words++\r\n    for (; i <= end && wb(text[i]); i++) ;\r\n  }\r\n\r\n  // stats\r\n  const minutes = words / wpm\r\n  const time = minutes * 60 * 1000\r\n  const displayed = Math.ceil(minutes.toFixed(2))\r\n\r\n  return {\r\n    text: displayed + ' min read',\r\n    minutes: minutes,\r\n    time: time,\r\n    words: words\r\n  }\r\n}","import React from 'react'\r\nimport { Link } from 'react-router-dom'\r\nimport { FiTrash2 } from 'react-icons/fi'\r\nimport formatDate from './utilities/formatDate'\r\nimport readingTime from './utilities/readingTime'\r\nimport './CardList.css'\r\n\r\n// No, regexs can't parse html. This is best effort because we don't want to spawn a parser.\r\nconst re = /<img\\b[^>]+?src\\s*=\\s*['\"]?([^\\s'\"?#>]+)/\r\n\r\nexport default class FeedList extends React.Component {\r\n  handleDelete = (e, article) => {\r\n    e.stopPropagation()\r\n    e.preventDefault()\r\n    this.props.onDelete(article)\r\n  }\r\n  \r\n  render() {\r\n    const { linkFormatter, authorFormatter, articleList, onDelete } = this.props\r\n    if (!articleList.size) return null\r\n    \r\n    return (articleList.map((article, i) => {\r\n      const scrapedImage = re.exec(article.text)\r\n      const imageSrc = scrapedImage ? scrapedImage[1] : null\r\n      const createdAt = formatDate(article.createdAt)\r\n      return (\r\n        <Link to={linkFormatter(article)} className=\"Card\" key={i}>\r\n          <div className=\"articleHeader\">\r\n            <div className=\"articleDate\">{createdAt}</div>\r\n            { onDelete ? <FiTrash2 className=\"articleDelete\" onClickCapture={e => this.handleDelete(e, article)} /> : null }\r\n          </div>\r\n          { imageSrc ? <div className=\"articleImageContainer\"><img alt={article.title} className=\"articleImagePreview\" src={imageSrc} /></div> : null }\r\n          <span className=\"articleTitle\">{article.title}</span>\r\n          <div className=\"articleDescription\">{article.description}</div>\r\n          <div className=\"articleAuthor\">By {`${authorFormatter(article)} - ${readingTime(article.text).text}`}</div>\r\n        </Link>\r\n      )\r\n    }\r\n  ))\r\n  }\r\n}","import React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { load, pin, advanceFeedPage, deleteMasterArticle } from '../duck/users'\r\nimport UserDetails from '../UserDetails'\r\nimport CardList from '../CardList'\r\nimport EmptyList from '../EmptyList'\r\nimport InvalidAddress from '../InvalidAddress'\r\nimport FullPageLoader from '../components/FullPageLoader'\r\nimport ConfirmationModal from '../components/ConfirmationModal'\r\nimport ShareProfile from '../components/ShareProfile'\r\nimport './FeedPage.css'\r\n\r\nclass FeedPage extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    const { userHash } = this.props.match.params\r\n    if (!props.users.get(userHash)) {\r\n      props.dispatch(load(userHash))\r\n    }\r\n    this.state = { toDelete: null }\r\n  }\r\n\r\n  handleDelete = id => this.setState({ toDelete: id })\r\n\r\n  removeArticle = () => {\r\n    this.props.dispatch(deleteMasterArticle(this.state.toDelete))\r\n    this.hideConfirmation()\r\n  }\r\n\r\n  hideConfirmation = () => this.setState({ toDelete: null })\r\n\r\n  handlePin = () => this.props.dispatch(pin(this.props.match.params.userHash, true))\r\n\r\n  handleUnpin = () => this.props.dispatch(pin(this.props.match.params.userHash, false))\r\n\r\n  handleMore = () => this.props.dispatch(advanceFeedPage(this.props.match.params.userHash))\r\n\r\n  handleProfileEdit = () => this.props.history.push('/profile', { internal: true })\r\n\r\n  render() {\r\n    const { userHash } = this.props.match.params\r\n    //const { userHash } = this.props.location.search\r\n    const currentUser = this.props.users.get(userHash)\r\n\r\n    if (!global.OrbitDB.isValidAddress(`/orbitdb/${userHash}/user`)) return (<InvalidAddress hash={userHash} />)\r\n\r\n    if (!currentUser || !currentUser.feed || !currentUser.metadata) {\r\n      return <FullPageLoader text=\"Loading feed...\" />\r\n    }\r\n\r\n    const isMaster = currentUser.isMaster\r\n    const showMore = currentUser.feed && currentUser.feed.size && currentUser.feed.size < currentUser.feed.first().feedLen\r\n    const { metadata } = currentUser\r\n    const articleList = currentUser.feed.reverse()\r\n\r\n    return (\r\n      <div className=\"Page FeedPage\">\r\n        <UserDetails\r\n          onEdit={this.handleProfileEdit}\r\n          name={metadata.get('name')}\r\n          location={metadata.get('location')}\r\n          info={metadata.get('info')}\r\n          showEdit={isMaster}\r\n          isPinned={currentUser.pinned}\r\n          onPin={this.handlePin}\r\n          onUnpin={this.handleUnpin}\r\n        />\r\n        { isMaster ? <ShareProfile url={`https://solipsis-project.github.io/vitriol-web/${userHash}`} /> : null}\r\n        { !articleList.size ?\r\n          <EmptyList isMaster={isMaster} /> :\r\n          <CardList\r\n            articleList={articleList}\r\n            linkFormatter={a => `/${userHash}/${a.hash}`}\r\n            authorFormatter={() => currentUser.metadata.get('name')}\r\n            onDelete={isMaster ? a => this.handleDelete(a.hash) : null}\r\n          />\r\n        }\r\n        { this.state.toDelete ?\r\n          <ConfirmationModal\r\n            text=\"Do you really want to remove this article?\"\r\n            buttons={(\r\n              <React.Fragment>\r\n                <button className=\"Button Secondary\" onClick={this.hideConfirmation}>Cancel</button>\r\n                <button className=\"Button Alert\" onClick={this.removeArticle}>Remove</button>\r\n              </React.Fragment>\r\n            )} />\r\n          : null}\r\n        { showMore ? <button className=\"Button\" onClick={this.handleMore}>More...</button> : null}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nfunction mapStateToProps({ users }) {\r\n  return { users }\r\n}\r\n\r\nconst ConnectedFeedPage = connect(mapStateToProps)(FeedPage)\r\nexport default ConnectedFeedPage\r\n\r\n","import React, { Component } from 'react'\r\nimport { FiBookmark } from 'react-icons/fi'\r\nimport './UserDetails.css'\r\n\r\nclass UserDetails extends Component {\r\n  handlePinUser = () => {\r\n    const { isPinned, onPin, onUnpin } = this.props\r\n    isPinned ? onUnpin() : onPin()\r\n  }\r\n  \r\n  render() {\r\n    const { name, location, info, showEdit, onEdit, isPinned } = this.props\r\n    const pinnedClass = `UserPinned ${isPinned ? 'pinned' : 'unpinned'}`\r\n    return (\r\n      <div className=\"UserDetails\">\r\n        <div className=\"UserDetailSection\">\r\n          <div className=\"UserName\">\r\n            { name }\r\n          </div>\r\n          <div className=\"UserLocation\">\r\n            { location }\r\n          </div>\r\n          <div className=\"UserInfo\">\r\n            { info }\r\n          </div>\r\n        </div>\r\n        { !showEdit ? <FiBookmark className={pinnedClass} onClick={this.handlePinUser}/> : null }\r\n        { showEdit ?\r\n          <div onClick={onEdit} className=\"Button UserEdit\">\r\n            Edit\r\n          </div>\r\n        : null }\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default UserDetails\r\n\r\n","import React from 'react'\r\nimport { FiInfo } from 'react-icons/fi'\r\nimport './ShareProfile.css'\r\n\r\nexport default class ShareProfile extends React.Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = { copied: false }\r\n  }\r\n  \r\n  handleCopy = () => {\r\n    if (navigator.clipboard) navigator.clipboard.writeText(this.props.url).then(this.showCopied)\r\n    else {\r\n      this.inputRef.select()\r\n      document.execCommand(\"copy\")\r\n      this.showCopied()\r\n    }\r\n  }\r\n  \r\n  showCopied = () => {\r\n    this.setState({ copied: true })\r\n    setTimeout(() => this.setState({ copied: false }), 2000)\r\n  }\r\n\r\n  handleClick = () => this.inputRef.setSelectionRange(0, this.inputRef.value.length)\r\n  \r\n  render() {\r\n    return (\r\n      <div className=\"ShareProfile\">\r\n        <div className=\"ShareProfileCard Card\">\r\n          <span className=\"ShareProfileMessage\">\r\n            <FiInfo />\r\n            <span className=\"ShareProfileTextMessage\">You can share your feed using this address:</span>\r\n          </span>\r\n          <div className=\"ShareProfileContainer\">\r\n            <input className=\"ShareInput\" ref={n => this.inputRef = n} onClick={this.handleClick} readOnly value={this.props.url} />\r\n            <button className=\"ShareButton Button\" onClick={this.handleCopy}>Copy</button>\r\n          </div>\r\n          <span className={`ShareMessage ${this.state.copied ? 'show' : ''}`}>Copied!</span>\r\n        </div>\r\n      </div>\r\n      )\r\n  }\r\n\r\n}","import React from 'react'\r\nimport { connect } from 'react-redux'\r\nimport dompurify from 'dompurify'\r\nimport { load, getArticle } from '../duck/users'\r\nimport Editor from '../Editor'\r\nimport FullPageLoader from '../components/FullPageLoader'\r\nimport InvalidAddress from '../InvalidAddress'\r\n\r\nclass ArticlePage extends React.Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = { loading: true, articleObject: null, invalidAddress: false }\r\n  }\r\n  \r\n  componentDidMount() {\r\n    this.getArticle()\r\n  }\r\n  \r\n  componentDidUpdate() {\r\n    if (!this.state.articleObject) this.getArticle()\r\n  }\r\n  \r\n  getArticle = () => {\r\n    if (this.state.invalidAddress) return\r\n    \r\n    const { userHash } = this.props.match.params\r\n    if (!global.OrbitDB.isValidAddress(`/orbitdb/${userHash}/user`)) return this.setState({ invalidAddress: true })\r\n    \r\n    if (!this.props.users.get(userHash)) return this.props.dispatch(load(userHash))\r\n    const { articleHash } = this.props.match.params\r\n    const currentUser = this.props.users.get(userHash)\r\n    const isReplicating = currentUser.replication.get('meta') || currentUser.replication.get('feed')\r\n    const feed = currentUser ? currentUser.feed : null\r\n    if (!feed) return // No user or no feed in user, return\r\n    \r\n    const articles = currentUser.articles\r\n    const articleObject = articles.get(articleHash) || feed.find(a => a.hash === articleHash) // Try to find it in the articles\r\n\r\n    if (articleObject) return this.setState({ loading: false, articleObject }) // Found, re-render\r\n    // We have everything but still we don't find it. If we're replicating, wait, otherwise, go get it.\r\n    if (!isReplicating) return this.props.dispatch(getArticle(userHash, articleHash)) \r\n  }\r\n  \r\n  render() {\r\n    const { userHash } = this.props.match.params\r\n    const currentUser = this.props.users.get(userHash)\r\n    \r\n    if (this.state.invalidAddress) return (<InvalidAddress hash={userHash} />)\r\n    if (this.state.loading) return <FullPageLoader text=\"Loading article...\" />\r\n    \r\n    const { articleObject } = this.state\r\n    const text = dompurify.sanitize(articleObject.text)\r\n    \r\n    return (<div className=\"FullPage\">\r\n              <Editor\r\n                readOnly\r\n                title={articleObject.title}\r\n                description={articleObject.description}\r\n                html={text}\r\n                author={{ name: currentUser.metadata.get('name'), url: `/${userHash}` }}\r\n              />\r\n            </div>)\r\n  }\r\n}\r\n\r\nfunction mapStateToProps({ users }) {\r\n  return { users }\r\n}\r\n\r\nconst ConnectedArticlePage = connect(mapStateToProps)(ArticlePage)\r\nexport default ConnectedArticlePage"],"sourceRoot":""}